  


<!DOCTYPE html>
<html>
  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# githubog: http://ogp.me/ns/fb/githubog#">
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>MikeC84/android_kernel_htc_shooter at nightly</title>
    <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="GitHub" />
    <link rel="fluid-icon" href="https://github.com/fluidicon.png" title="GitHub" />
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="apple-touch-icon-114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="apple-touch-icon-114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="apple-touch-icon-144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="apple-touch-icon-144.png" />

    
    
    <link rel="icon" type="image/x-icon" href="/favicon.png" />

    <meta content="authenticity_token" name="csrf-param" />
<meta content="6s1B4XwYqK//N5xrhOcsfIPC1caSLco6tmolK0lKXJE=" name="csrf-token" />

    <link href="https://a248.e.akamai.net/assets.github.com/assets/github-4a6f56afc5353439638a253b08505cecf02c3a54.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="https://a248.e.akamai.net/assets.github.com/assets/github2-ec633d5f66ace9f8980be996584fa5e48d4b8553.css" media="screen" rel="stylesheet" type="text/css" />
    


    <script src="https://a248.e.akamai.net/assets.github.com/assets/frameworks-cc8431500f70fcd18c6da029472b59d6c39d0d95.js" type="text/javascript"></script>
    
    <script defer="defer" src="https://a248.e.akamai.net/assets.github.com/assets/github-e90b1a4861c8d27beb08e2415a55df3285ac581c.js" type="text/javascript"></script>
    
    

        <meta property="og:title" content="android_kernel_htc_shooter"/>
    <meta property="og:type" content="githubog:gitrepository"/>
    <meta property="og:url" content="https://github.com/MikeC84/android_kernel_htc_shooter"/>
    <meta property="og:image" content="https://a248.e.akamai.net/assets.github.com/images/gravatars/gravatar-user-420.png?1345673562"/>
    <meta property="og:site_name" content="GitHub"/>
    <meta property="og:description" content="Linux Kernel 3.0.16 for shooter (HTC EVO 3D). Contribute to android_kernel_htc_shooter development by creating an account on GitHub."/>

    <meta name="description" content="Linux Kernel 3.0.16 for shooter (HTC EVO 3D). Contribute to android_kernel_htc_shooter development by creating an account on GitHub." />

  <link href="https://github.com/MikeC84/android_kernel_htc_shooter/commits/e365591c6cacf807a865d078e5794d0245d603a4.atom" rel="alternate" title="Recent Commits to android_kernel_htc_shooter:e365591c6cacf807a865d078e5794d0245d603a4" type="application/atom+xml" />

  </head>


  <body class="logged_in  macintosh vis-public fork env-production ">
    <div id="wrapper">

    
    

      <div id="header" class="true clearfix">
        <div class="container clearfix">
          <a class="site-logo" href="https://github.com/">
            <img alt="GitHub" class="github-logo-4x" height="30" src="https://a248.e.akamai.net/assets.github.com/images/modules/header/logov7@4x.png?1338956357" />
            <img alt="GitHub" class="github-logo-4x-hover" height="30" src="https://a248.e.akamai.net/assets.github.com/images/modules/header/logov7@4x-hover.png?1338956357" />
          </a>

              <a href="/notifications" class="notification-indicator tooltipped downwards" title="You have no unread notifications">
                <span class="mail-status all-read"></span>
              </a>

              
    <div class="topsearch ">
        <form accept-charset="UTF-8" action="/search" id="top_search_form" method="get">
  <a href="/search" class="advanced-search tooltipped downwards" title="Advanced Search"><span class="mini-icon mini-icon-advanced-search"></span></a>
  <div class="search placeholder-field js-placeholder-field">
    <input type="text" class="search my_repos_autocompleter" id="global-search-field" name="q" results="5" spellcheck="false" autocomplete="off" data-autocomplete="my-repos-autocomplete" placeholder="Search&hellip;" data-hotkey="s" />
    <div id="my-repos-autocomplete" class="autocomplete-results">
      <ul class="js-navigation-container"></ul>
    </div>
    <input type="submit" value="Search" class="button">
    <span class="mini-icon mini-icon-search-input"></span>
  </div>
  <input type="hidden" name="type" value="Everything" />
  <input type="hidden" name="repo" value="" />
  <input type="hidden" name="langOverride" value="" />
  <input type="hidden" name="start_value" value="1" />
</form>

      <ul class="top-nav">
          <li class="explore"><a href="https://github.com/explore">Explore</a></li>
          <li><a href="https://gist.github.com">Gist</a></li>
          <li><a href="/blog">Blog</a></li>
        <li><a href="http://help.github.com">Help</a></li>
      </ul>
    </div>


            


  <div id="userbox">
    <div id="user">
      <a href="https://github.com/zarboz"><img height="20" src="https://secure.gravatar.com/avatar/ad781ba87cd2f1da75765d59ce27ced9?s=140&amp;d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png" width="20" /></a>
      <a href="https://github.com/zarboz" class="name">zarboz</a>
    </div>
    <ul id="user-links">
      <li>
        <a href="/new" id="new_repo" class="tooltipped downwards" title="Create a New Repo"><span class="mini-icon mini-icon-create"></span></a>
      </li>
      <li>
        <a href="/settings/profile" id="account_settings"
          class="tooltipped downwards"
          title="Account Settings ">
          <span class="mini-icon mini-icon-account-settings"></span>
        </a>
      </li>
      <li>
          <a href="/logout" data-method="post" id="logout" class="tooltipped downwards" title="Sign Out">
            <span class="mini-icon mini-icon-logout"></span>
          </a>
      </li>
    </ul>
  </div>



          
        </div>
      </div>

      

      

            <div class="site hfeed" itemscope itemtype="http://schema.org/WebPage">
      <div class="container hentry">
        <div class="pagehead repohead instapaper_ignore readability-menu">
        <div class="title-actions-bar">
          



              <ul class="pagehead-actions">


          <li class="subscription">
              <form accept-charset="UTF-8" action="/notifications/subscribe" data-autosubmit="true" data-remote="true" method="post"><div style="margin:0;padding:0;display:inline"><input name="authenticity_token" type="hidden" value="6s1B4XwYqK//N5xrhOcsfIPC1caSLco6tmolK0lKXJE=" /></div>
  <input id="repository_id" name="repository_id" type="hidden" value="5307476" />
  <div class="context-menu-container js-menu-container js-context-menu">
    <span class="minibutton switcher bigger js-menu-target">
      <span class="js-context-button">
          <span class="mini-icon mini-icon-watching"></span> Watch
      </span>
    </span>

    <div class="context-pane js-menu-content">
      <a href="javascript:;" class="close js-menu-close"><span class="mini-icon mini-icon-remove-close"></span></a>
      <div class="context-title">Notification status</div>

      <div class="context-body pane-selector">
        <ul class="js-navigation-container">
          <li class="selector-item js-navigation-item js-navigation-target selected">
            <span class="mini-icon mini-icon-confirm"></span>
            <label>
              <input checked="checked" id="do_included" name="do" type="radio" value="included" />
              <h4>Not watching</h4>
              <p>You will only receive notifications when you participate or are mentioned.</p>
            </label>
            <span class="context-button-text js-context-button-text">
              <span class="mini-icon mini-icon-watching"></span>
              Watch
            </span>
          </li>
          <li class="selector-item js-navigation-item js-navigation-target ">
            <span class="mini-icon mini-icon-confirm"></span>
            <label>
              <input id="do_subscribed" name="do" type="radio" value="subscribed" />
              <h4>Watching</h4>
              <p>You will receive all notifications for this repository.</p>
            </label>
            <span class="context-button-text js-context-button-text">
              <span class="mini-icon mini-icon-unwatch"></span>
              Unwatch
            </span>
          </li>
          <li class="selector-item js-navigation-item js-navigation-target ">
            <span class="mini-icon mini-icon-confirm"></span>
            <label>
              <input id="do_ignore" name="do" type="radio" value="ignore" />
              <h4>Ignored</h4>
              <p>You will not receive notifications for this repository.</p>
            </label>
            <span class="context-button-text js-context-button-text">
              <span class="mini-icon mini-icon-mute"></span>
              Stop ignoring
            </span>
          </li>
        </ul>
      </div>
    </div>
  </div>
</form>
          </li>

          <li class="js-toggler-container js-social-container starring-container ">
            <a href="/MikeC84/android_kernel_htc_shooter/unstar" class="minibutton js-toggler-target starred" data-remote="true" data-method="post" rel="nofollow">
              <span class="mini-icon mini-icon-star"></span>
                Unstar
            </a><a href="/MikeC84/android_kernel_htc_shooter/star" class="minibutton js-toggler-target unstarred" data-remote="true" data-method="post" rel="nofollow">
              <span class="mini-icon mini-icon-star"></span>
                Star
            </a><a class="social-count js-social-count" href="/MikeC84/android_kernel_htc_shooter/stargazers">2</a>
          </li>

              <li><a href="/MikeC84/android_kernel_htc_shooter/fork" class="minibutton btn-fork js-toggler-target fork-button lighter" rel="nofollow" data-method="post">Fork</a><a href="/MikeC84/android_kernel_htc_shooter/network" class="social-count">10</a>
              </li>


    </ul>

          <h1 itemscope itemtype="http://data-vocabulary.org/Breadcrumb" class="entry-title public">
            <span class="repo-label"><span>public</span></span>
            <span class="mega-icon mega-icon-repo-forked"></span>
            <span class="author vcard">
<a href="/MikeC84" class="url fn" itemprop="url" rel="author">              <span itemprop="title">MikeC84</span>
              </a></span> /
            <strong><a href="/MikeC84/android_kernel_htc_shooter" class="js-current-repository">android_kernel_htc_shooter</a></strong>
              <span class="fork-flag">
                <span class="text">forked from <a href="/agrabren/android_kernel_htc_shooter">agrabren/android_kernel_htc_shooter</a></span>
              </span>
          </h1>
        </div>

          

  <ul class="tabs">
    <li><a href="/MikeC84/android_kernel_htc_shooter/tree/" class="selected" highlight="repo_sourcerepo_downloadsrepo_commitsrepo_tagsrepo_branches">Code</a></li>
    <li><a href="/MikeC84/android_kernel_htc_shooter/network" highlight="repo_network">Network</a>
    <li><a href="/MikeC84/android_kernel_htc_shooter/pulls" highlight="repo_pulls">Pull Requests <span class='counter'>0</span></a></li>


      <li><a href="/MikeC84/android_kernel_htc_shooter/wiki" highlight="repo_wiki">Wiki</a></li>

    <li><a href="/MikeC84/android_kernel_htc_shooter/graphs" highlight="repo_graphsrepo_contributors">Graphs</a></li>


  </ul>
  
<div class="frame frame-center tree-finder" style="display:none"
      data-tree-list-url="/MikeC84/android_kernel_htc_shooter/tree-list/e365591c6cacf807a865d078e5794d0245d603a4"
      data-blob-url-prefix="/MikeC84/android_kernel_htc_shooter/blob/e365591c6cacf807a865d078e5794d0245d603a4"
    >

  <div class="breadcrumb">
    <span class="bold"><a href="/MikeC84/android_kernel_htc_shooter">android_kernel_htc_shooter</a></span> /
    <input class="tree-finder-input js-navigation-enable" type="text" name="query" autocomplete="off" spellcheck="false">
  </div>

    <div class="octotip">
      <p>
        <a href="/MikeC84/android_kernel_htc_shooter/dismiss-tree-finder-help" class="dismiss js-dismiss-tree-list-help" title="Hide this notice forever" rel="nofollow">Dismiss</a>
        <span class="bold">Octotip:</span> You've activated the <em>file finder</em>
        by pressing <span class="kbd">t</span> Start typing to filter the
        file list. Use <span class="kbd badmono">↑</span> and
        <span class="kbd badmono">↓</span> to navigate,
        <span class="kbd">enter</span> to view files.
      </p>
    </div>

  <table class="tree-browser" cellpadding="0" cellspacing="0">
    <tr class="js-header"><th>&nbsp;</th><th>name</th></tr>
    <tr class="js-no-results no-results" style="display: none">
      <th colspan="2">No matching files</th>
    </tr>
    <tbody class="js-results-list js-navigation-container">
    </tbody>
  </table>
</div>

<div id="jump-to-line" style="display:none">
  <h2>Jump to Line</h2>
  <form accept-charset="UTF-8">
    <input class="textfield" type="text">
    <div class="full-button">
      <button type="submit" class="classy">
        Go
      </button>
    </div>
  </form>
</div>


<div class="tabnav">

  <span class="tabnav-right">
    <ul class="tabnav-tabs">
      <li><a href="/MikeC84/android_kernel_htc_shooter/tags" class="tabnav-tab" highlight="repo_tags">Tags <span class="counter blank">0</span></a></li>
      <li><a href="/MikeC84/android_kernel_htc_shooter/downloads" class="tabnav-tab" highlight="repo_downloads">Downloads <span class="counter blank">0</span></a></li>
    </ul>
    
  </span>

  <div class="tabnav-widget scope">

    <div class="context-menu-container js-menu-container js-context-menu">
      <a href="#"
         class="minibutton bigger switcher js-menu-target js-commitish-button btn-tree repo-tree"
         data-hotkey="w"
         data-master-branch="nightly"
         data-ref="">
         <span><i>tree:</i> e365591c6c</span>
      </a>

      <div class="context-pane commitish-context js-menu-content">
        <a href="javascript:;" class="close js-menu-close"><span class="mini-icon mini-icon-remove-close"></span></a>
        <div class="context-title">Switch branches/tags</div>
        <div class="context-body pane-selector commitish-selector js-navigation-container">
          <div class="filterbar">
            <input type="text" id="context-commitish-filter-field" class="js-navigation-enable" placeholder="Filter branches/tags" data-filterable />
            <ul class="tabs">
              <li><a href="#" data-filter="branches" class="selected">Branches</a></li>
              <li><a href="#" data-filter="tags">Tags</a></li>
            </ul>
          </div>

          <div class="js-filter-tab js-filter-branches" data-filterable-for="context-commitish-filter-field" data-filterable-type=substring>
            <div class="no-results js-not-filterable">Nothing to show</div>
              <div class="commitish-item branch-commitish selector-item js-navigation-item js-navigation-target ">
                <span class="mini-icon mini-icon-confirm"></span>
                <h4>
                    <a href="/MikeC84/android_kernel_htc_shooter/blame/nightly/block/bfq-sched.c" class="js-navigation-open" data-name="nightly" rel="nofollow">nightly</a>
                </h4>
              </div>
          </div>

          <div class="js-filter-tab js-filter-tags" style="display:none" data-filterable-for="context-commitish-filter-field" data-filterable-type=substring>
            <div class="no-results js-not-filterable">Nothing to show</div>
          </div>
        </div>
      </div><!-- /.commitish-context-context -->
    </div>
  </div> <!-- /.scope -->

  <ul class="tabnav-tabs">
    <li><a href="/MikeC84/android_kernel_htc_shooter/tree/" class="selected tabnav-tab" highlight="repo_source">Files</a></li>
    <li><a href="/MikeC84/android_kernel_htc_shooter/commits/" class="tabnav-tab" highlight="repo_commits">Commits</a></li>
    <li><a href="/MikeC84/android_kernel_htc_shooter/branches" class="tabnav-tab" highlight="repo_branches" rel="nofollow">Branches <span class="counter ">1</span></a></li>
  </ul>

</div>

  
  
  


          

        </div><!-- /.repohead -->

        <div id="js-repo-pjax-container" data-pjax-container>
          


    <p class="last-commit locked"><span class="mini-icon mini-icon-commit"></span> Browsing ref <tt>e365591c6c</tt></p>

<div class="commit commit-tease js-details-container">
  <p class="commit-title ">
      <a href="/MikeC84/android_kernel_htc_shooter/commit/e365591c6cacf807a865d078e5794d0245d603a4" class="message">Update BFQ Scheduler to v4</a>
      
  </p>
  <div class="commit-meta">
    <a href="/MikeC84/android_kernel_htc_shooter/commit/e365591c6cacf807a865d078e5794d0245d603a4" class="sha-block">commit <span class="sha">e365591c6c</span></a>
    <span class="js-clippy mini-icon mini-icon-clippy " data-clipboard-text="e365591c6cacf807a865d078e5794d0245d603a4" data-copied-hint="copied!" data-copy-hint="Copy SHA"></span>

    <div class="authorship">
      <img class="gravatar" height="20" src="https://secure.gravatar.com/avatar/8106dca8c9e06a4e09ca8e0c94cfd8f1?s=140&amp;d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png" width="20" />
      <span class="author-name"><a href="/MikeC84" rel="author">MikeC84</a></span>
      authored <time class="js-relative-date updated" datetime="2012-08-20T22:48:38-07:00" title="2012-08-20 22:48:38">August 20, 2012</time>

    </div>
  </div>
</div>



<div class="breadcrumb" data-path="block/bfq-sched.c/">
  <b itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="/MikeC84/android_kernel_htc_shooter/tree/e365591c6cacf807a865d078e5794d0245d603a4" class="js-rewrite-sha" itemprop="url"><span itemprop="title">android_kernel_htc_shooter</span></a></b> / <span itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="/MikeC84/android_kernel_htc_shooter/tree/e365591c6cacf807a865d078e5794d0245d603a4/block" class="js-rewrite-sha" itemscope="url"><span itemprop="title">block</span></a></span> / <strong class="final-path">bfq-sched.c</strong> <span class="js-clippy mini-icon mini-icon-clippy " data-clipboard-text="block/bfq-sched.c" data-copied-hint="copied!" data-copy-hint="copy to clipboard"></span>
</div>

<div id="files">
  <div class="file">
    <div class="meta" style="border-bottom: none;">
      <div class="info">
        <span class="icon"><span class="mini-icon mini-icon-text-file"></span></span>
        <span class="mode" title="File Mode">100644</span>
          <span>1068 lines (903 sloc)</span>
        <span>28.885 kb</span>
      </div>
      <ul class="actions">
        <li><a href="/MikeC84/android_kernel_htc_shooter/raw/e365591c6cacf807a865d078e5794d0245d603a4/block/bfq-sched.c" id="raw-url">raw</a></li>
        <li><a href="/MikeC84/android_kernel_htc_shooter/blob/e365591c6cacf807a865d078e5794d0245d603a4/block/bfq-sched.c">normal view</a></li>
        <li><a href="/MikeC84/android_kernel_htc_shooter/commits/e365591c6cacf807a865d078e5794d0245d603a4/block/bfq-sched.c" rel="nofollow">history</a></li>
      </ul>
    </div>

    <div class="highlight data blame">
      <table width="100%" cellpadding="0" cellspacing="0">

            <tr class="section-first">
            <td nowrap class="commitinfo">
              <code>
                <a href="/MikeC84/android_kernel_htc_shooter/commit/8540bba587cf4e5fbcecf0f5184f69d627fee7cd">8540bba5</a>
                <a href="/MikeC84/android_kernel_htc_shooter/blame/8540bba587cf4e5fbcecf0f5184f69d627fee7cd/block/bfq-sched.c">&#187;</a>
                <a href="/MikeC84">MikeC84</a>
              </code>
              <br />
              <span class="date">2012-07-24</span>
              <span class="message" title="Add BFQ IO Scheduler">Add BFQ IO Scheduler </span>
            </td>
          <td nowrap class="line-number" id="LID1" rel="#L1">1</td>
          <td nowrap class="line-data " id="LC1"><span class="cm">/*</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID2" rel="#L2">2</td>
          <td nowrap class="line-data " id="LC2"><span class="cm"> * BFQ: Hierarchical B-WF2Q+ scheduler.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID3" rel="#L3">3</td>
          <td nowrap class="line-data " id="LC3"><span class="cm"> *</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID4" rel="#L4">4</td>
          <td nowrap class="line-data " id="LC4"><span class="cm"> * Based on ideas and code from CFQ:</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID5" rel="#L5">5</td>
          <td nowrap class="line-data " id="LC5"><span class="cm"> * Copyright (C) 2003 Jens Axboe &lt;axboe@kernel.dk&gt;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID6" rel="#L6">6</td>
          <td nowrap class="line-data " id="LC6"><span class="cm"> *</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID7" rel="#L7">7</td>
          <td nowrap class="line-data " id="LC7"><span class="cm"> * Copyright (C) 2008 Fabio Checconi &lt;fabio@gandalf.sssup.it&gt;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID8" rel="#L8">8</td>
          <td nowrap class="line-data " id="LC8"><span class="cm"> *		      Paolo Valente &lt;paolo.valente@unimore.it&gt;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID9" rel="#L9">9</td>
          <td nowrap class="line-data " id="LC9"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID10" rel="#L10">10</td>
          <td nowrap class="line-data " id="LC10"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID11" rel="#L11">11</td>
          <td nowrap class="line-data " id="LC11"><span class="cp">#ifdef CONFIG_CGROUP_BFQIO</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID12" rel="#L12">12</td>
          <td nowrap class="line-data " id="LC12"><span class="cp">#define for_each_entity(entity)	\</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID13" rel="#L13">13</td>
          <td nowrap class="line-data " id="LC13"><span class="cp">	for (; entity != NULL; entity = entity-&gt;parent)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID14" rel="#L14">14</td>
          <td nowrap class="line-data " id="LC14"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID15" rel="#L15">15</td>
          <td nowrap class="line-data " id="LC15"><span class="cp">#define for_each_entity_safe(entity, parent) \</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID16" rel="#L16">16</td>
          <td nowrap class="line-data " id="LC16"><span class="cp">	for (; entity &amp;&amp; ({ parent = entity-&gt;parent; 1; }); entity = parent)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID17" rel="#L17">17</td>
          <td nowrap class="line-data " id="LC17"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID18" rel="#L18">18</td>
          <td nowrap class="line-data " id="LC18"><span class="k">static</span> <span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">bfq_lookup_next_entity</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_sched_data</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID19" rel="#L19">19</td>
          <td nowrap class="line-data " id="LC19">						 <span class="kt">int</span> <span class="n">extract</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID20" rel="#L20">20</td>
          <td nowrap class="line-data " id="LC20">						 <span class="k">struct</span> <span class="n">bfq_data</span> <span class="o">*</span><span class="n">bfqd</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID21" rel="#L21">21</td>
          <td nowrap class="line-data " id="LC21"></td>
        </tr>
            <tr class="section-first">
            <td nowrap class="commitinfo">
              <code>
                <a href="/MikeC84/android_kernel_htc_shooter/commit/e365591c6cacf807a865d078e5794d0245d603a4">e365591c</a>
                <a href="/MikeC84/android_kernel_htc_shooter/blame/e365591c6cacf807a865d078e5794d0245d603a4/block/bfq-sched.c">&#187;</a>
                <a href="/MikeC84">MikeC84</a>
              </code>
              <br />
              <span class="date">2012-08-20</span>
              <span class="message" title="Update BFQ Scheduler to v4">Update BFQ Scheduler to v4 </span>
            </td>
          <td nowrap class="line-number" id="LID22" rel="#L22">22</td>
          <td nowrap class="line-data " id="LC22"><span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">bfq_update_budget</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">next_active</span><span class="p">)</span></td>
        </tr>
            <tr class="section-first">
            <td nowrap class="commitinfo">
              <code>
                <a href="/MikeC84/android_kernel_htc_shooter/commit/8540bba587cf4e5fbcecf0f5184f69d627fee7cd">8540bba5</a>
                <a href="/MikeC84/android_kernel_htc_shooter/blame/8540bba587cf4e5fbcecf0f5184f69d627fee7cd/block/bfq-sched.c">&#187;</a>
                <a href="/MikeC84">MikeC84</a>
              </code>
              <br />
              <span class="date">2012-07-24</span>
              <span class="message" title="Add BFQ IO Scheduler">Add BFQ IO Scheduler </span>
            </td>
          <td nowrap class="line-number" id="LID23" rel="#L23">23</td>
          <td nowrap class="line-data " id="LC23"><span class="p">{</span></td>
        </tr>
            <tr class="section-first">
            <td nowrap class="commitinfo">
              <code>
                <a href="/MikeC84/android_kernel_htc_shooter/commit/e365591c6cacf807a865d078e5794d0245d603a4">e365591c</a>
                <a href="/MikeC84/android_kernel_htc_shooter/blame/e365591c6cacf807a865d078e5794d0245d603a4/block/bfq-sched.c">&#187;</a>
                <a href="/MikeC84">MikeC84</a>
              </code>
              <br />
              <span class="date">2012-08-20</span>
              <span class="message" title="Update BFQ Scheduler to v4">Update BFQ Scheduler to v4 </span>
            </td>
          <td nowrap class="line-number" id="LID24" rel="#L24">24</td>
          <td nowrap class="line-data " id="LC24">	<span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">bfqg_entity</span><span class="p">;</span></td>
        </tr>
            <tr class="section-first">
            <td nowrap class="commitinfo">
              <code>
                <a href="/MikeC84/android_kernel_htc_shooter/commit/8540bba587cf4e5fbcecf0f5184f69d627fee7cd">8540bba5</a>
                <a href="/MikeC84/android_kernel_htc_shooter/blame/8540bba587cf4e5fbcecf0f5184f69d627fee7cd/block/bfq-sched.c">&#187;</a>
                <a href="/MikeC84">MikeC84</a>
              </code>
              <br />
              <span class="date">2012-07-24</span>
              <span class="message" title="Add BFQ IO Scheduler">Add BFQ IO Scheduler </span>
            </td>
          <td nowrap class="line-number" id="LID25" rel="#L25">25</td>
          <td nowrap class="line-data " id="LC25">	<span class="k">struct</span> <span class="n">bfq_group</span> <span class="o">*</span><span class="n">bfqg</span><span class="p">;</span></td>
        </tr>
            <tr class="section-first">
            <td nowrap class="commitinfo">
              <code>
                <a href="/MikeC84/android_kernel_htc_shooter/commit/e365591c6cacf807a865d078e5794d0245d603a4">e365591c</a>
                <a href="/MikeC84/android_kernel_htc_shooter/blame/e365591c6cacf807a865d078e5794d0245d603a4/block/bfq-sched.c">&#187;</a>
                <a href="/MikeC84">MikeC84</a>
              </code>
              <br />
              <span class="date">2012-08-20</span>
              <span class="message" title="Update BFQ Scheduler to v4">Update BFQ Scheduler to v4 </span>
            </td>
          <td nowrap class="line-number" id="LID26" rel="#L26">26</td>
          <td nowrap class="line-data " id="LC26">	<span class="k">struct</span> <span class="n">bfq_sched_data</span> <span class="o">*</span><span class="n">group_sd</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID27" rel="#L27">27</td>
          <td nowrap class="line-data " id="LC27"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID28" rel="#L28">28</td>
          <td nowrap class="line-data " id="LC28">	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">next_active</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID29" rel="#L29">29</td>
          <td nowrap class="line-data " id="LC29"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID30" rel="#L30">30</td>
          <td nowrap class="line-data " id="LC30">	<span class="n">group_sd</span> <span class="o">=</span> <span class="n">next_active</span><span class="o">-&gt;</span><span class="n">sched_data</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID31" rel="#L31">31</td>
          <td nowrap class="line-data " id="LC31"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID32" rel="#L32">32</td>
          <td nowrap class="line-data " id="LC32">	<span class="n">bfqg</span> <span class="o">=</span> <span class="n">container_of</span><span class="p">(</span><span class="n">group_sd</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bfq_group</span><span class="p">,</span> <span class="n">sched_data</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID33" rel="#L33">33</td>
          <td nowrap class="line-data " id="LC33">	<span class="cm">/*</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID34" rel="#L34">34</td>
          <td nowrap class="line-data " id="LC34"><span class="cm">	 * bfq_group&#39;s my_entity field is not NULL only if the group</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID35" rel="#L35">35</td>
          <td nowrap class="line-data " id="LC35"><span class="cm">	 * is not the root group. We must not touch the root entity</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID36" rel="#L36">36</td>
          <td nowrap class="line-data " id="LC36"><span class="cm">	 * as it must never become an active entity.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID37" rel="#L37">37</td>
          <td nowrap class="line-data " id="LC37"><span class="cm">	 */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID38" rel="#L38">38</td>
          <td nowrap class="line-data " id="LC38">	<span class="n">bfqg_entity</span> <span class="o">=</span> <span class="n">bfqg</span><span class="o">-&gt;</span><span class="n">my_entity</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID39" rel="#L39">39</td>
          <td nowrap class="line-data " id="LC39">	<span class="k">if</span> <span class="p">(</span><span class="n">bfqg_entity</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID40" rel="#L40">40</td>
          <td nowrap class="line-data " id="LC40">		<span class="n">bfqg_entity</span><span class="o">-&gt;</span><span class="n">budget</span> <span class="o">=</span> <span class="n">next_active</span><span class="o">-&gt;</span><span class="n">budget</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID41" rel="#L41">41</td>
          <td nowrap class="line-data " id="LC41"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID42" rel="#L42">42</td>
          <td nowrap class="line-data " id="LC42"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID43" rel="#L43">43</td>
          <td nowrap class="line-data " id="LC43"><span class="k">static</span> <span class="kt">int</span> <span class="nf">bfq_update_next_active</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_sched_data</span> <span class="o">*</span><span class="n">sd</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID44" rel="#L44">44</td>
          <td nowrap class="line-data " id="LC44"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID45" rel="#L45">45</td>
          <td nowrap class="line-data " id="LC45">	<span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">next_active</span><span class="p">;</span></td>
        </tr>
            <tr class="section-first">
            <td nowrap class="commitinfo">
              <code>
                <a href="/MikeC84/android_kernel_htc_shooter/commit/8540bba587cf4e5fbcecf0f5184f69d627fee7cd">8540bba5</a>
                <a href="/MikeC84/android_kernel_htc_shooter/blame/8540bba587cf4e5fbcecf0f5184f69d627fee7cd/block/bfq-sched.c">&#187;</a>
                <a href="/MikeC84">MikeC84</a>
              </code>
              <br />
              <span class="date">2012-07-24</span>
              <span class="message" title="Add BFQ IO Scheduler">Add BFQ IO Scheduler </span>
            </td>
          <td nowrap class="line-number" id="LID46" rel="#L46">46</td>
          <td nowrap class="line-data " id="LC46"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID47" rel="#L47">47</td>
          <td nowrap class="line-data " id="LC47">	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">active_entity</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID48" rel="#L48">48</td>
          <td nowrap class="line-data " id="LC48">		<span class="cm">/* will update/requeue at the end of service */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID49" rel="#L49">49</td>
          <td nowrap class="line-data " id="LC49">		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID50" rel="#L50">50</td>
          <td nowrap class="line-data " id="LC50"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID51" rel="#L51">51</td>
          <td nowrap class="line-data " id="LC51">	<span class="cm">/*</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID52" rel="#L52">52</td>
          <td nowrap class="line-data " id="LC52"><span class="cm">	 * NOTE: this can be improved in many ways, such as returning</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID53" rel="#L53">53</td>
          <td nowrap class="line-data " id="LC53"><span class="cm">	 * 1 (and thus propagating upwards the update) only when the</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID54" rel="#L54">54</td>
          <td nowrap class="line-data " id="LC54"><span class="cm">	 * budget changes, or caching the bfqq that will be scheduled</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID55" rel="#L55">55</td>
          <td nowrap class="line-data " id="LC55"><span class="cm">	 * next from this subtree.  By now we worry more about</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID56" rel="#L56">56</td>
          <td nowrap class="line-data " id="LC56"><span class="cm">	 * correctness than about performance...</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID57" rel="#L57">57</td>
          <td nowrap class="line-data " id="LC57"><span class="cm">	 */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID58" rel="#L58">58</td>
          <td nowrap class="line-data " id="LC58">	<span class="n">next_active</span> <span class="o">=</span> <span class="n">bfq_lookup_next_entity</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID59" rel="#L59">59</td>
          <td nowrap class="line-data " id="LC59">	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">next_active</span> <span class="o">=</span> <span class="n">next_active</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID60" rel="#L60">60</td>
          <td nowrap class="line-data " id="LC60"></td>
        </tr>
            <tr class="section-first">
            <td nowrap class="commitinfo">
              <code>
                <a href="/MikeC84/android_kernel_htc_shooter/commit/e365591c6cacf807a865d078e5794d0245d603a4">e365591c</a>
                <a href="/MikeC84/android_kernel_htc_shooter/blame/e365591c6cacf807a865d078e5794d0245d603a4/block/bfq-sched.c">&#187;</a>
                <a href="/MikeC84">MikeC84</a>
              </code>
              <br />
              <span class="date">2012-08-20</span>
              <span class="message" title="Update BFQ Scheduler to v4">Update BFQ Scheduler to v4 </span>
            </td>
          <td nowrap class="line-number" id="LID61" rel="#L61">61</td>
          <td nowrap class="line-data " id="LC61">	<span class="k">if</span> <span class="p">(</span><span class="n">next_active</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID62" rel="#L62">62</td>
          <td nowrap class="line-data " id="LC62">		<span class="n">bfq_update_budget</span><span class="p">(</span><span class="n">next_active</span><span class="p">);</span></td>
        </tr>
            <tr class="section-first">
            <td nowrap class="commitinfo">
              <code>
                <a href="/MikeC84/android_kernel_htc_shooter/commit/8540bba587cf4e5fbcecf0f5184f69d627fee7cd">8540bba5</a>
                <a href="/MikeC84/android_kernel_htc_shooter/blame/8540bba587cf4e5fbcecf0f5184f69d627fee7cd/block/bfq-sched.c">&#187;</a>
                <a href="/MikeC84">MikeC84</a>
              </code>
              <br />
              <span class="date">2012-07-24</span>
              <span class="message" title="Add BFQ IO Scheduler">Add BFQ IO Scheduler </span>
            </td>
          <td nowrap class="line-number" id="LID63" rel="#L63">63</td>
          <td nowrap class="line-data " id="LC63"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID64" rel="#L64">64</td>
          <td nowrap class="line-data " id="LC64">	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID65" rel="#L65">65</td>
          <td nowrap class="line-data " id="LC65"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID66" rel="#L66">66</td>
          <td nowrap class="line-data " id="LC66"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID67" rel="#L67">67</td>
          <td nowrap class="line-data " id="LC67"><span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">bfq_check_next_active</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_sched_data</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID68" rel="#L68">68</td>
          <td nowrap class="line-data " id="LC68">					 <span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID69" rel="#L69">69</td>
          <td nowrap class="line-data " id="LC69"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID70" rel="#L70">70</td>
          <td nowrap class="line-data " id="LC70">	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">next_active</span> <span class="o">!=</span> <span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID71" rel="#L71">71</td>
          <td nowrap class="line-data " id="LC71"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID72" rel="#L72">72</td>
          <td nowrap class="line-data " id="LC72"><span class="cp">#else</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID73" rel="#L73">73</td>
          <td nowrap class="line-data " id="LC73"><span class="cp">#define for_each_entity(entity)	\</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID74" rel="#L74">74</td>
          <td nowrap class="line-data " id="LC74"><span class="cp">	for (; entity != NULL; entity = NULL)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID75" rel="#L75">75</td>
          <td nowrap class="line-data " id="LC75"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID76" rel="#L76">76</td>
          <td nowrap class="line-data " id="LC76"><span class="cp">#define for_each_entity_safe(entity, parent) \</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID77" rel="#L77">77</td>
          <td nowrap class="line-data " id="LC77"><span class="cp">	for (parent = NULL; entity != NULL; entity = parent)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID78" rel="#L78">78</td>
          <td nowrap class="line-data " id="LC78"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID79" rel="#L79">79</td>
          <td nowrap class="line-data " id="LC79"><span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">bfq_update_next_active</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_sched_data</span> <span class="o">*</span><span class="n">sd</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID80" rel="#L80">80</td>
          <td nowrap class="line-data " id="LC80"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID81" rel="#L81">81</td>
          <td nowrap class="line-data " id="LC81">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID82" rel="#L82">82</td>
          <td nowrap class="line-data " id="LC82"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID83" rel="#L83">83</td>
          <td nowrap class="line-data " id="LC83"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID84" rel="#L84">84</td>
          <td nowrap class="line-data " id="LC84"><span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">bfq_check_next_active</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_sched_data</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID85" rel="#L85">85</td>
          <td nowrap class="line-data " id="LC85">					 <span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID86" rel="#L86">86</td>
          <td nowrap class="line-data " id="LC86"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID87" rel="#L87">87</td>
          <td nowrap class="line-data " id="LC87"><span class="p">}</span></td>
        </tr>
            <tr class="section-first">
            <td nowrap class="commitinfo">
              <code>
                <a href="/MikeC84/android_kernel_htc_shooter/commit/e365591c6cacf807a865d078e5794d0245d603a4">e365591c</a>
                <a href="/MikeC84/android_kernel_htc_shooter/blame/e365591c6cacf807a865d078e5794d0245d603a4/block/bfq-sched.c">&#187;</a>
                <a href="/MikeC84">MikeC84</a>
              </code>
              <br />
              <span class="date">2012-08-20</span>
              <span class="message" title="Update BFQ Scheduler to v4">Update BFQ Scheduler to v4 </span>
            </td>
          <td nowrap class="line-number" id="LID88" rel="#L88">88</td>
          <td nowrap class="line-data " id="LC88"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID89" rel="#L89">89</td>
          <td nowrap class="line-data " id="LC89"><span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">bfq_update_budget</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">next_active</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID90" rel="#L90">90</td>
          <td nowrap class="line-data " id="LC90"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID91" rel="#L91">91</td>
          <td nowrap class="line-data " id="LC91"><span class="p">}</span></td>
        </tr>
            <tr class="section-first">
            <td nowrap class="commitinfo">
              <code>
                <a href="/MikeC84/android_kernel_htc_shooter/commit/8540bba587cf4e5fbcecf0f5184f69d627fee7cd">8540bba5</a>
                <a href="/MikeC84/android_kernel_htc_shooter/blame/8540bba587cf4e5fbcecf0f5184f69d627fee7cd/block/bfq-sched.c">&#187;</a>
                <a href="/MikeC84">MikeC84</a>
              </code>
              <br />
              <span class="date">2012-07-24</span>
              <span class="message" title="Add BFQ IO Scheduler">Add BFQ IO Scheduler </span>
            </td>
          <td nowrap class="line-number" id="LID92" rel="#L92">92</td>
          <td nowrap class="line-data " id="LC92"><span class="cp">#endif</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID93" rel="#L93">93</td>
          <td nowrap class="line-data " id="LC93"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID94" rel="#L94">94</td>
          <td nowrap class="line-data " id="LC94"><span class="cm">/*</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID95" rel="#L95">95</td>
          <td nowrap class="line-data " id="LC95"><span class="cm"> * Shift for timestamp calculations.  This actually limits the maximum</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID96" rel="#L96">96</td>
          <td nowrap class="line-data " id="LC96"><span class="cm"> * service allowed in one timestamp delta (small shift values increase it),</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID97" rel="#L97">97</td>
          <td nowrap class="line-data " id="LC97"><span class="cm"> * the maximum total weight that can be used for the queues in the system</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID98" rel="#L98">98</td>
          <td nowrap class="line-data " id="LC98"><span class="cm"> * (big shift values increase it), and the period of virtual time wraparounds.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID99" rel="#L99">99</td>
          <td nowrap class="line-data " id="LC99"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID100" rel="#L100">100</td>
          <td nowrap class="line-data " id="LC100"><span class="cp">#define WFQ_SERVICE_SHIFT	22</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID101" rel="#L101">101</td>
          <td nowrap class="line-data " id="LC101"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID102" rel="#L102">102</td>
          <td nowrap class="line-data " id="LC102"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID103" rel="#L103">103</td>
          <td nowrap class="line-data " id="LC103"><span class="cm"> * bfq_gt - compare two timestamps.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID104" rel="#L104">104</td>
          <td nowrap class="line-data " id="LC104"><span class="cm"> * @a: first ts.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID105" rel="#L105">105</td>
          <td nowrap class="line-data " id="LC105"><span class="cm"> * @b: second ts.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID106" rel="#L106">106</td>
          <td nowrap class="line-data " id="LC106"><span class="cm"> *</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID107" rel="#L107">107</td>
          <td nowrap class="line-data " id="LC107"><span class="cm"> * Return @a &gt; @b, dealing with wrapping correctly.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID108" rel="#L108">108</td>
          <td nowrap class="line-data " id="LC108"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID109" rel="#L109">109</td>
          <td nowrap class="line-data " id="LC109"><span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">bfq_gt</span><span class="p">(</span><span class="n">u64</span> <span class="n">a</span><span class="p">,</span> <span class="n">u64</span> <span class="n">b</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID110" rel="#L110">110</td>
          <td nowrap class="line-data " id="LC110"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID111" rel="#L111">111</td>
          <td nowrap class="line-data " id="LC111">	<span class="k">return</span> <span class="p">(</span><span class="n">s64</span><span class="p">)(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID112" rel="#L112">112</td>
          <td nowrap class="line-data " id="LC112"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID113" rel="#L113">113</td>
          <td nowrap class="line-data " id="LC113"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID114" rel="#L114">114</td>
          <td nowrap class="line-data " id="LC114"><span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">bfq_queue</span> <span class="o">*</span><span class="nf">bfq_entity_to_bfqq</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID115" rel="#L115">115</td>
          <td nowrap class="line-data " id="LC115"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID116" rel="#L116">116</td>
          <td nowrap class="line-data " id="LC116">	<span class="k">struct</span> <span class="n">bfq_queue</span> <span class="o">*</span><span class="n">bfqq</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID117" rel="#L117">117</td>
          <td nowrap class="line-data " id="LC117"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID118" rel="#L118">118</td>
          <td nowrap class="line-data " id="LC118">	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">entity</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID119" rel="#L119">119</td>
          <td nowrap class="line-data " id="LC119"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID120" rel="#L120">120</td>
          <td nowrap class="line-data " id="LC120">	<span class="k">if</span> <span class="p">(</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">my_sched_data</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID121" rel="#L121">121</td>
          <td nowrap class="line-data " id="LC121">		<span class="n">bfqq</span> <span class="o">=</span> <span class="n">container_of</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bfq_queue</span><span class="p">,</span> <span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID122" rel="#L122">122</td>
          <td nowrap class="line-data " id="LC122"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID123" rel="#L123">123</td>
          <td nowrap class="line-data " id="LC123">	<span class="k">return</span> <span class="n">bfqq</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID124" rel="#L124">124</td>
          <td nowrap class="line-data " id="LC124"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID125" rel="#L125">125</td>
          <td nowrap class="line-data " id="LC125"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID126" rel="#L126">126</td>
          <td nowrap class="line-data " id="LC126"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID127" rel="#L127">127</td>
          <td nowrap class="line-data " id="LC127"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID128" rel="#L128">128</td>
          <td nowrap class="line-data " id="LC128"><span class="cm"> * bfq_delta - map service into the virtual time domain.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID129" rel="#L129">129</td>
          <td nowrap class="line-data " id="LC129"><span class="cm"> * @service: amount of service.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID130" rel="#L130">130</td>
          <td nowrap class="line-data " id="LC130"><span class="cm"> * @weight: scale factor (weight of an entity or weight sum).</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID131" rel="#L131">131</td>
          <td nowrap class="line-data " id="LC131"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID132" rel="#L132">132</td>
          <td nowrap class="line-data " id="LC132"><span class="k">static</span> <span class="kr">inline</span> <span class="n">u64</span> <span class="nf">bfq_delta</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">service</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID133" rel="#L133">133</td>
          <td nowrap class="line-data " id="LC133">					<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">weight</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID134" rel="#L134">134</td>
          <td nowrap class="line-data " id="LC134"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID135" rel="#L135">135</td>
          <td nowrap class="line-data " id="LC135">	<span class="n">u64</span> <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">u64</span><span class="p">)</span><span class="n">service</span> <span class="o">&lt;&lt;</span> <span class="n">WFQ_SERVICE_SHIFT</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID136" rel="#L136">136</td>
          <td nowrap class="line-data " id="LC136"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID137" rel="#L137">137</td>
          <td nowrap class="line-data " id="LC137">	<span class="n">do_div</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">weight</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID138" rel="#L138">138</td>
          <td nowrap class="line-data " id="LC138">	<span class="k">return</span> <span class="n">d</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID139" rel="#L139">139</td>
          <td nowrap class="line-data " id="LC139"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID140" rel="#L140">140</td>
          <td nowrap class="line-data " id="LC140"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID141" rel="#L141">141</td>
          <td nowrap class="line-data " id="LC141"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID142" rel="#L142">142</td>
          <td nowrap class="line-data " id="LC142"><span class="cm"> * bfq_calc_finish - assign the finish time to an entity.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID143" rel="#L143">143</td>
          <td nowrap class="line-data " id="LC143"><span class="cm"> * @entity: the entity to act upon.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID144" rel="#L144">144</td>
          <td nowrap class="line-data " id="LC144"><span class="cm"> * @service: the service to be charged to the entity.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID145" rel="#L145">145</td>
          <td nowrap class="line-data " id="LC145"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID146" rel="#L146">146</td>
          <td nowrap class="line-data " id="LC146"><span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">bfq_calc_finish</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID147" rel="#L147">147</td>
          <td nowrap class="line-data " id="LC147">				   <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">service</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID148" rel="#L148">148</td>
          <td nowrap class="line-data " id="LC148"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID149" rel="#L149">149</td>
          <td nowrap class="line-data " id="LC149">	<span class="k">struct</span> <span class="n">bfq_queue</span> <span class="o">*</span><span class="n">bfqq</span> <span class="o">=</span> <span class="n">bfq_entity_to_bfqq</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID150" rel="#L150">150</td>
          <td nowrap class="line-data " id="LC150"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID151" rel="#L151">151</td>
          <td nowrap class="line-data " id="LC151">	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">weight</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID152" rel="#L152">152</td>
          <td nowrap class="line-data " id="LC152"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID153" rel="#L153">153</td>
          <td nowrap class="line-data " id="LC153">	<span class="n">entity</span><span class="o">-&gt;</span><span class="n">finish</span> <span class="o">=</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">start</span> <span class="o">+</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID154" rel="#L154">154</td>
          <td nowrap class="line-data " id="LC154">		<span class="n">bfq_delta</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">weight</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID155" rel="#L155">155</td>
          <td nowrap class="line-data " id="LC155"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID156" rel="#L156">156</td>
          <td nowrap class="line-data " id="LC156">	<span class="k">if</span> <span class="p">(</span><span class="n">bfqq</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID157" rel="#L157">157</td>
          <td nowrap class="line-data " id="LC157">		<span class="n">bfq_log_bfqq</span><span class="p">(</span><span class="n">bfqq</span><span class="o">-&gt;</span><span class="n">bfqd</span><span class="p">,</span> <span class="n">bfqq</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID158" rel="#L158">158</td>
          <td nowrap class="line-data " id="LC158">			<span class="s">&quot;calc_finish: serv %lu, w %d&quot;</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID159" rel="#L159">159</td>
          <td nowrap class="line-data " id="LC159">			<span class="n">service</span><span class="p">,</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">weight</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID160" rel="#L160">160</td>
          <td nowrap class="line-data " id="LC160">		<span class="n">bfq_log_bfqq</span><span class="p">(</span><span class="n">bfqq</span><span class="o">-&gt;</span><span class="n">bfqd</span><span class="p">,</span> <span class="n">bfqq</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID161" rel="#L161">161</td>
          <td nowrap class="line-data " id="LC161">			<span class="s">&quot;calc_finish: start %llu, finish %llu, delta %llu&quot;</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID162" rel="#L162">162</td>
          <td nowrap class="line-data " id="LC162">			<span class="n">entity</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">,</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">finish</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID163" rel="#L163">163</td>
          <td nowrap class="line-data " id="LC163">			<span class="n">bfq_delta</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">weight</span><span class="p">));</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID164" rel="#L164">164</td>
          <td nowrap class="line-data " id="LC164">	<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID165" rel="#L165">165</td>
          <td nowrap class="line-data " id="LC165"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID166" rel="#L166">166</td>
          <td nowrap class="line-data " id="LC166"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID167" rel="#L167">167</td>
          <td nowrap class="line-data " id="LC167"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID168" rel="#L168">168</td>
          <td nowrap class="line-data " id="LC168"><span class="cm"> * bfq_entity_of - get an entity from a node.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID169" rel="#L169">169</td>
          <td nowrap class="line-data " id="LC169"><span class="cm"> * @node: the node field of the entity.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID170" rel="#L170">170</td>
          <td nowrap class="line-data " id="LC170"><span class="cm"> *</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID171" rel="#L171">171</td>
          <td nowrap class="line-data " id="LC171"><span class="cm"> * Convert a node pointer to the relative entity.  This is used only</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID172" rel="#L172">172</td>
          <td nowrap class="line-data " id="LC172"><span class="cm"> * to simplify the logic of some functions and not as the generic</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID173" rel="#L173">173</td>
          <td nowrap class="line-data " id="LC173"><span class="cm"> * conversion mechanism because, e.g., in the tree walking functions,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID174" rel="#L174">174</td>
          <td nowrap class="line-data " id="LC174"><span class="cm"> * the check for a %NULL value would be redundant.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID175" rel="#L175">175</td>
          <td nowrap class="line-data " id="LC175"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID176" rel="#L176">176</td>
          <td nowrap class="line-data " id="LC176"><span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="nf">bfq_entity_of</span><span class="p">(</span><span class="k">struct</span> <span class="n">rb_node</span> <span class="o">*</span><span class="n">node</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID177" rel="#L177">177</td>
          <td nowrap class="line-data " id="LC177"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID178" rel="#L178">178</td>
          <td nowrap class="line-data " id="LC178">	<span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID179" rel="#L179">179</td>
          <td nowrap class="line-data " id="LC179"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID180" rel="#L180">180</td>
          <td nowrap class="line-data " id="LC180">	<span class="k">if</span> <span class="p">(</span><span class="n">node</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID181" rel="#L181">181</td>
          <td nowrap class="line-data " id="LC181">		<span class="n">entity</span> <span class="o">=</span> <span class="n">rb_entry</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bfq_entity</span><span class="p">,</span> <span class="n">rb_node</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID182" rel="#L182">182</td>
          <td nowrap class="line-data " id="LC182"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID183" rel="#L183">183</td>
          <td nowrap class="line-data " id="LC183">	<span class="k">return</span> <span class="n">entity</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID184" rel="#L184">184</td>
          <td nowrap class="line-data " id="LC184"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID185" rel="#L185">185</td>
          <td nowrap class="line-data " id="LC185"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID186" rel="#L186">186</td>
          <td nowrap class="line-data " id="LC186"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID187" rel="#L187">187</td>
          <td nowrap class="line-data " id="LC187"><span class="cm"> * bfq_extract - remove an entity from a tree.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID188" rel="#L188">188</td>
          <td nowrap class="line-data " id="LC188"><span class="cm"> * @root: the tree root.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID189" rel="#L189">189</td>
          <td nowrap class="line-data " id="LC189"><span class="cm"> * @entity: the entity to remove.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID190" rel="#L190">190</td>
          <td nowrap class="line-data " id="LC190"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID191" rel="#L191">191</td>
          <td nowrap class="line-data " id="LC191"><span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">bfq_extract</span><span class="p">(</span><span class="k">struct</span> <span class="n">rb_root</span> <span class="o">*</span><span class="n">root</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID192" rel="#L192">192</td>
          <td nowrap class="line-data " id="LC192">			       <span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID193" rel="#L193">193</td>
          <td nowrap class="line-data " id="LC193"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID194" rel="#L194">194</td>
          <td nowrap class="line-data " id="LC194">	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">tree</span> <span class="o">!=</span> <span class="n">root</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID195" rel="#L195">195</td>
          <td nowrap class="line-data " id="LC195"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID196" rel="#L196">196</td>
          <td nowrap class="line-data " id="LC196">	<span class="n">entity</span><span class="o">-&gt;</span><span class="n">tree</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID197" rel="#L197">197</td>
          <td nowrap class="line-data " id="LC197">	<span class="n">rb_erase</span><span class="p">(</span><span class="o">&amp;</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">rb_node</span><span class="p">,</span> <span class="n">root</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID198" rel="#L198">198</td>
          <td nowrap class="line-data " id="LC198"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID199" rel="#L199">199</td>
          <td nowrap class="line-data " id="LC199"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID200" rel="#L200">200</td>
          <td nowrap class="line-data " id="LC200"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID201" rel="#L201">201</td>
          <td nowrap class="line-data " id="LC201"><span class="cm"> * bfq_idle_extract - extract an entity from the idle tree.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID202" rel="#L202">202</td>
          <td nowrap class="line-data " id="LC202"><span class="cm"> * @st: the service tree of the owning @entity.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID203" rel="#L203">203</td>
          <td nowrap class="line-data " id="LC203"><span class="cm"> * @entity: the entity being removed.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID204" rel="#L204">204</td>
          <td nowrap class="line-data " id="LC204"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID205" rel="#L205">205</td>
          <td nowrap class="line-data " id="LC205"><span class="k">static</span> <span class="kt">void</span> <span class="nf">bfq_idle_extract</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_service_tree</span> <span class="o">*</span><span class="n">st</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID206" rel="#L206">206</td>
          <td nowrap class="line-data " id="LC206">			     <span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID207" rel="#L207">207</td>
          <td nowrap class="line-data " id="LC207"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID208" rel="#L208">208</td>
          <td nowrap class="line-data " id="LC208">	<span class="k">struct</span> <span class="n">bfq_queue</span> <span class="o">*</span><span class="n">bfqq</span> <span class="o">=</span> <span class="n">bfq_entity_to_bfqq</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID209" rel="#L209">209</td>
          <td nowrap class="line-data " id="LC209">	<span class="k">struct</span> <span class="n">rb_node</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID210" rel="#L210">210</td>
          <td nowrap class="line-data " id="LC210"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID211" rel="#L211">211</td>
          <td nowrap class="line-data " id="LC211">	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">tree</span> <span class="o">!=</span> <span class="o">&amp;</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">idle</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID212" rel="#L212">212</td>
          <td nowrap class="line-data " id="LC212"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID213" rel="#L213">213</td>
          <td nowrap class="line-data " id="LC213">	<span class="k">if</span> <span class="p">(</span><span class="n">entity</span> <span class="o">==</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">first_idle</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID214" rel="#L214">214</td>
          <td nowrap class="line-data " id="LC214">		<span class="n">next</span> <span class="o">=</span> <span class="n">rb_next</span><span class="p">(</span><span class="o">&amp;</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">rb_node</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID215" rel="#L215">215</td>
          <td nowrap class="line-data " id="LC215">		<span class="n">st</span><span class="o">-&gt;</span><span class="n">first_idle</span> <span class="o">=</span> <span class="n">bfq_entity_of</span><span class="p">(</span><span class="n">next</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID216" rel="#L216">216</td>
          <td nowrap class="line-data " id="LC216">	<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID217" rel="#L217">217</td>
          <td nowrap class="line-data " id="LC217"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID218" rel="#L218">218</td>
          <td nowrap class="line-data " id="LC218">	<span class="k">if</span> <span class="p">(</span><span class="n">entity</span> <span class="o">==</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">last_idle</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID219" rel="#L219">219</td>
          <td nowrap class="line-data " id="LC219">		<span class="n">next</span> <span class="o">=</span> <span class="n">rb_prev</span><span class="p">(</span><span class="o">&amp;</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">rb_node</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID220" rel="#L220">220</td>
          <td nowrap class="line-data " id="LC220">		<span class="n">st</span><span class="o">-&gt;</span><span class="n">last_idle</span> <span class="o">=</span> <span class="n">bfq_entity_of</span><span class="p">(</span><span class="n">next</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID221" rel="#L221">221</td>
          <td nowrap class="line-data " id="LC221">	<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID222" rel="#L222">222</td>
          <td nowrap class="line-data " id="LC222"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID223" rel="#L223">223</td>
          <td nowrap class="line-data " id="LC223">	<span class="n">bfq_extract</span><span class="p">(</span><span class="o">&amp;</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">idle</span><span class="p">,</span> <span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID224" rel="#L224">224</td>
          <td nowrap class="line-data " id="LC224"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID225" rel="#L225">225</td>
          <td nowrap class="line-data " id="LC225">	<span class="k">if</span> <span class="p">(</span><span class="n">bfqq</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID226" rel="#L226">226</td>
          <td nowrap class="line-data " id="LC226">		<span class="n">list_del</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bfqq</span><span class="o">-&gt;</span><span class="n">bfqq_list</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID227" rel="#L227">227</td>
          <td nowrap class="line-data " id="LC227"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID228" rel="#L228">228</td>
          <td nowrap class="line-data " id="LC228"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID229" rel="#L229">229</td>
          <td nowrap class="line-data " id="LC229"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID230" rel="#L230">230</td>
          <td nowrap class="line-data " id="LC230"><span class="cm"> * bfq_insert - generic tree insertion.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID231" rel="#L231">231</td>
          <td nowrap class="line-data " id="LC231"><span class="cm"> * @root: tree root.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID232" rel="#L232">232</td>
          <td nowrap class="line-data " id="LC232"><span class="cm"> * @entity: entity to insert.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID233" rel="#L233">233</td>
          <td nowrap class="line-data " id="LC233"><span class="cm"> *</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID234" rel="#L234">234</td>
          <td nowrap class="line-data " id="LC234"><span class="cm"> * This is used for the idle and the active tree, since they are both</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID235" rel="#L235">235</td>
          <td nowrap class="line-data " id="LC235"><span class="cm"> * ordered by finish time.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID236" rel="#L236">236</td>
          <td nowrap class="line-data " id="LC236"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID237" rel="#L237">237</td>
          <td nowrap class="line-data " id="LC237"><span class="k">static</span> <span class="kt">void</span> <span class="nf">bfq_insert</span><span class="p">(</span><span class="k">struct</span> <span class="n">rb_root</span> <span class="o">*</span><span class="n">root</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID238" rel="#L238">238</td>
          <td nowrap class="line-data " id="LC238"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID239" rel="#L239">239</td>
          <td nowrap class="line-data " id="LC239">	<span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entry</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID240" rel="#L240">240</td>
          <td nowrap class="line-data " id="LC240">	<span class="k">struct</span> <span class="n">rb_node</span> <span class="o">**</span><span class="n">node</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">root</span><span class="o">-&gt;</span><span class="n">rb_node</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID241" rel="#L241">241</td>
          <td nowrap class="line-data " id="LC241">	<span class="k">struct</span> <span class="n">rb_node</span> <span class="o">*</span><span class="n">parent</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID242" rel="#L242">242</td>
          <td nowrap class="line-data " id="LC242"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID243" rel="#L243">243</td>
          <td nowrap class="line-data " id="LC243">	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">tree</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID244" rel="#L244">244</td>
          <td nowrap class="line-data " id="LC244"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID245" rel="#L245">245</td>
          <td nowrap class="line-data " id="LC245">	<span class="k">while</span> <span class="p">(</span><span class="o">*</span><span class="n">node</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID246" rel="#L246">246</td>
          <td nowrap class="line-data " id="LC246">		<span class="n">parent</span> <span class="o">=</span> <span class="o">*</span><span class="n">node</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID247" rel="#L247">247</td>
          <td nowrap class="line-data " id="LC247">		<span class="n">entry</span> <span class="o">=</span> <span class="n">rb_entry</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bfq_entity</span><span class="p">,</span> <span class="n">rb_node</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID248" rel="#L248">248</td>
          <td nowrap class="line-data " id="LC248"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID249" rel="#L249">249</td>
          <td nowrap class="line-data " id="LC249">		<span class="k">if</span> <span class="p">(</span><span class="n">bfq_gt</span><span class="p">(</span><span class="n">entry</span><span class="o">-&gt;</span><span class="n">finish</span><span class="p">,</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">finish</span><span class="p">))</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID250" rel="#L250">250</td>
          <td nowrap class="line-data " id="LC250">			<span class="n">node</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">parent</span><span class="o">-&gt;</span><span class="n">rb_left</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID251" rel="#L251">251</td>
          <td nowrap class="line-data " id="LC251">		<span class="k">else</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID252" rel="#L252">252</td>
          <td nowrap class="line-data " id="LC252">			<span class="n">node</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">parent</span><span class="o">-&gt;</span><span class="n">rb_right</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID253" rel="#L253">253</td>
          <td nowrap class="line-data " id="LC253">	<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID254" rel="#L254">254</td>
          <td nowrap class="line-data " id="LC254"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID255" rel="#L255">255</td>
          <td nowrap class="line-data " id="LC255">	<span class="n">rb_link_node</span><span class="p">(</span><span class="o">&amp;</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">rb_node</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">node</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID256" rel="#L256">256</td>
          <td nowrap class="line-data " id="LC256">	<span class="n">rb_insert_color</span><span class="p">(</span><span class="o">&amp;</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">rb_node</span><span class="p">,</span> <span class="n">root</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID257" rel="#L257">257</td>
          <td nowrap class="line-data " id="LC257"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID258" rel="#L258">258</td>
          <td nowrap class="line-data " id="LC258">	<span class="n">entity</span><span class="o">-&gt;</span><span class="n">tree</span> <span class="o">=</span> <span class="n">root</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID259" rel="#L259">259</td>
          <td nowrap class="line-data " id="LC259"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID260" rel="#L260">260</td>
          <td nowrap class="line-data " id="LC260"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID261" rel="#L261">261</td>
          <td nowrap class="line-data " id="LC261"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID262" rel="#L262">262</td>
          <td nowrap class="line-data " id="LC262"><span class="cm"> * bfq_update_min - update the min_start field of a entity.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID263" rel="#L263">263</td>
          <td nowrap class="line-data " id="LC263"><span class="cm"> * @entity: the entity to update.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID264" rel="#L264">264</td>
          <td nowrap class="line-data " id="LC264"><span class="cm"> * @node: one of its children.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID265" rel="#L265">265</td>
          <td nowrap class="line-data " id="LC265"><span class="cm"> *</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID266" rel="#L266">266</td>
          <td nowrap class="line-data " id="LC266"><span class="cm"> * This function is called when @entity may store an invalid value for</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID267" rel="#L267">267</td>
          <td nowrap class="line-data " id="LC267"><span class="cm"> * min_start due to updates to the active tree.  The function  assumes</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID268" rel="#L268">268</td>
          <td nowrap class="line-data " id="LC268"><span class="cm"> * that the subtree rooted at @node (which may be its left or its right</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID269" rel="#L269">269</td>
          <td nowrap class="line-data " id="LC269"><span class="cm"> * child) has a valid min_start value.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID270" rel="#L270">270</td>
          <td nowrap class="line-data " id="LC270"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID271" rel="#L271">271</td>
          <td nowrap class="line-data " id="LC271"><span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">bfq_update_min</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID272" rel="#L272">272</td>
          <td nowrap class="line-data " id="LC272">				  <span class="k">struct</span> <span class="n">rb_node</span> <span class="o">*</span><span class="n">node</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID273" rel="#L273">273</td>
          <td nowrap class="line-data " id="LC273"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID274" rel="#L274">274</td>
          <td nowrap class="line-data " id="LC274">	<span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">child</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID275" rel="#L275">275</td>
          <td nowrap class="line-data " id="LC275"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID276" rel="#L276">276</td>
          <td nowrap class="line-data " id="LC276">	<span class="k">if</span> <span class="p">(</span><span class="n">node</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID277" rel="#L277">277</td>
          <td nowrap class="line-data " id="LC277">		<span class="n">child</span> <span class="o">=</span> <span class="n">rb_entry</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bfq_entity</span><span class="p">,</span> <span class="n">rb_node</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID278" rel="#L278">278</td>
          <td nowrap class="line-data " id="LC278">		<span class="k">if</span> <span class="p">(</span><span class="n">bfq_gt</span><span class="p">(</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">min_start</span><span class="p">,</span> <span class="n">child</span><span class="o">-&gt;</span><span class="n">min_start</span><span class="p">))</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID279" rel="#L279">279</td>
          <td nowrap class="line-data " id="LC279">			<span class="n">entity</span><span class="o">-&gt;</span><span class="n">min_start</span> <span class="o">=</span> <span class="n">child</span><span class="o">-&gt;</span><span class="n">min_start</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID280" rel="#L280">280</td>
          <td nowrap class="line-data " id="LC280">	<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID281" rel="#L281">281</td>
          <td nowrap class="line-data " id="LC281"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID282" rel="#L282">282</td>
          <td nowrap class="line-data " id="LC282"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID283" rel="#L283">283</td>
          <td nowrap class="line-data " id="LC283"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID284" rel="#L284">284</td>
          <td nowrap class="line-data " id="LC284"><span class="cm"> * bfq_update_active_node - recalculate min_start.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID285" rel="#L285">285</td>
          <td nowrap class="line-data " id="LC285"><span class="cm"> * @node: the node to update.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID286" rel="#L286">286</td>
          <td nowrap class="line-data " id="LC286"><span class="cm"> *</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID287" rel="#L287">287</td>
          <td nowrap class="line-data " id="LC287"><span class="cm"> * @node may have changed position or one of its children may have moved,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID288" rel="#L288">288</td>
          <td nowrap class="line-data " id="LC288"><span class="cm"> * this function updates its min_start value.  The left and right subtrees</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID289" rel="#L289">289</td>
          <td nowrap class="line-data " id="LC289"><span class="cm"> * are assumed to hold a correct min_start value.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID290" rel="#L290">290</td>
          <td nowrap class="line-data " id="LC290"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID291" rel="#L291">291</td>
          <td nowrap class="line-data " id="LC291"><span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">bfq_update_active_node</span><span class="p">(</span><span class="k">struct</span> <span class="n">rb_node</span> <span class="o">*</span><span class="n">node</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID292" rel="#L292">292</td>
          <td nowrap class="line-data " id="LC292"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID293" rel="#L293">293</td>
          <td nowrap class="line-data " id="LC293">	<span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span> <span class="o">=</span> <span class="n">rb_entry</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bfq_entity</span><span class="p">,</span> <span class="n">rb_node</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID294" rel="#L294">294</td>
          <td nowrap class="line-data " id="LC294"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID295" rel="#L295">295</td>
          <td nowrap class="line-data " id="LC295">	<span class="n">entity</span><span class="o">-&gt;</span><span class="n">min_start</span> <span class="o">=</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID296" rel="#L296">296</td>
          <td nowrap class="line-data " id="LC296">	<span class="n">bfq_update_min</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">rb_right</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID297" rel="#L297">297</td>
          <td nowrap class="line-data " id="LC297">	<span class="n">bfq_update_min</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">rb_left</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID298" rel="#L298">298</td>
          <td nowrap class="line-data " id="LC298"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID299" rel="#L299">299</td>
          <td nowrap class="line-data " id="LC299"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID300" rel="#L300">300</td>
          <td nowrap class="line-data " id="LC300"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID301" rel="#L301">301</td>
          <td nowrap class="line-data " id="LC301"><span class="cm"> * bfq_update_active_tree - update min_start for the whole active tree.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID302" rel="#L302">302</td>
          <td nowrap class="line-data " id="LC302"><span class="cm"> * @node: the starting node.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID303" rel="#L303">303</td>
          <td nowrap class="line-data " id="LC303"><span class="cm"> *</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID304" rel="#L304">304</td>
          <td nowrap class="line-data " id="LC304"><span class="cm"> * @node must be the deepest modified node after an update.  This function</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID305" rel="#L305">305</td>
          <td nowrap class="line-data " id="LC305"><span class="cm"> * updates its min_start using the values held by its children, assuming</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID306" rel="#L306">306</td>
          <td nowrap class="line-data " id="LC306"><span class="cm"> * that they did not change, and then updates all the nodes that may have</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID307" rel="#L307">307</td>
          <td nowrap class="line-data " id="LC307"><span class="cm"> * changed in the path to the root.  The only nodes that may have changed</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID308" rel="#L308">308</td>
          <td nowrap class="line-data " id="LC308"><span class="cm"> * are the ones in the path or their siblings.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID309" rel="#L309">309</td>
          <td nowrap class="line-data " id="LC309"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID310" rel="#L310">310</td>
          <td nowrap class="line-data " id="LC310"><span class="k">static</span> <span class="kt">void</span> <span class="nf">bfq_update_active_tree</span><span class="p">(</span><span class="k">struct</span> <span class="n">rb_node</span> <span class="o">*</span><span class="n">node</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID311" rel="#L311">311</td>
          <td nowrap class="line-data " id="LC311"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID312" rel="#L312">312</td>
          <td nowrap class="line-data " id="LC312">	<span class="k">struct</span> <span class="n">rb_node</span> <span class="o">*</span><span class="n">parent</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID313" rel="#L313">313</td>
          <td nowrap class="line-data " id="LC313"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID314" rel="#L314">314</td>
          <td nowrap class="line-data " id="LC314"><span class="nl">up:</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID315" rel="#L315">315</td>
          <td nowrap class="line-data " id="LC315">	<span class="n">bfq_update_active_node</span><span class="p">(</span><span class="n">node</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID316" rel="#L316">316</td>
          <td nowrap class="line-data " id="LC316"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID317" rel="#L317">317</td>
          <td nowrap class="line-data " id="LC317">	<span class="n">parent</span> <span class="o">=</span> <span class="n">rb_parent</span><span class="p">(</span><span class="n">node</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID318" rel="#L318">318</td>
          <td nowrap class="line-data " id="LC318">	<span class="k">if</span> <span class="p">(</span><span class="n">parent</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID319" rel="#L319">319</td>
          <td nowrap class="line-data " id="LC319">		<span class="k">return</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID320" rel="#L320">320</td>
          <td nowrap class="line-data " id="LC320"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID321" rel="#L321">321</td>
          <td nowrap class="line-data " id="LC321">	<span class="k">if</span> <span class="p">(</span><span class="n">node</span> <span class="o">==</span> <span class="n">parent</span><span class="o">-&gt;</span><span class="n">rb_left</span> <span class="o">&amp;&amp;</span> <span class="n">parent</span><span class="o">-&gt;</span><span class="n">rb_right</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID322" rel="#L322">322</td>
          <td nowrap class="line-data " id="LC322">		<span class="n">bfq_update_active_node</span><span class="p">(</span><span class="n">parent</span><span class="o">-&gt;</span><span class="n">rb_right</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID323" rel="#L323">323</td>
          <td nowrap class="line-data " id="LC323">	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">parent</span><span class="o">-&gt;</span><span class="n">rb_left</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID324" rel="#L324">324</td>
          <td nowrap class="line-data " id="LC324">		<span class="n">bfq_update_active_node</span><span class="p">(</span><span class="n">parent</span><span class="o">-&gt;</span><span class="n">rb_left</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID325" rel="#L325">325</td>
          <td nowrap class="line-data " id="LC325"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID326" rel="#L326">326</td>
          <td nowrap class="line-data " id="LC326">	<span class="n">node</span> <span class="o">=</span> <span class="n">parent</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID327" rel="#L327">327</td>
          <td nowrap class="line-data " id="LC327">	<span class="k">goto</span> <span class="n">up</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID328" rel="#L328">328</td>
          <td nowrap class="line-data " id="LC328"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID329" rel="#L329">329</td>
          <td nowrap class="line-data " id="LC329"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID330" rel="#L330">330</td>
          <td nowrap class="line-data " id="LC330"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID331" rel="#L331">331</td>
          <td nowrap class="line-data " id="LC331"><span class="cm"> * bfq_active_insert - insert an entity in the active tree of its group/device.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID332" rel="#L332">332</td>
          <td nowrap class="line-data " id="LC332"><span class="cm"> * @st: the service tree of the entity.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID333" rel="#L333">333</td>
          <td nowrap class="line-data " id="LC333"><span class="cm"> * @entity: the entity being inserted.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID334" rel="#L334">334</td>
          <td nowrap class="line-data " id="LC334"><span class="cm"> *</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID335" rel="#L335">335</td>
          <td nowrap class="line-data " id="LC335"><span class="cm"> * The active tree is ordered by finish time, but an extra key is kept</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID336" rel="#L336">336</td>
          <td nowrap class="line-data " id="LC336"><span class="cm"> * per each node, containing the minimum value for the start times of</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID337" rel="#L337">337</td>
          <td nowrap class="line-data " id="LC337"><span class="cm"> * its children (and the node itself), so it&#39;s possible to search for</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID338" rel="#L338">338</td>
          <td nowrap class="line-data " id="LC338"><span class="cm"> * the eligible node with the lowest finish time in logarithmic time.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID339" rel="#L339">339</td>
          <td nowrap class="line-data " id="LC339"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID340" rel="#L340">340</td>
          <td nowrap class="line-data " id="LC340"><span class="k">static</span> <span class="kt">void</span> <span class="nf">bfq_active_insert</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_service_tree</span> <span class="o">*</span><span class="n">st</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID341" rel="#L341">341</td>
          <td nowrap class="line-data " id="LC341">			      <span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID342" rel="#L342">342</td>
          <td nowrap class="line-data " id="LC342"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID343" rel="#L343">343</td>
          <td nowrap class="line-data " id="LC343">	<span class="k">struct</span> <span class="n">bfq_queue</span> <span class="o">*</span><span class="n">bfqq</span> <span class="o">=</span> <span class="n">bfq_entity_to_bfqq</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID344" rel="#L344">344</td>
          <td nowrap class="line-data " id="LC344">	<span class="k">struct</span> <span class="n">rb_node</span> <span class="o">*</span><span class="n">node</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">rb_node</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID345" rel="#L345">345</td>
          <td nowrap class="line-data " id="LC345"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID346" rel="#L346">346</td>
          <td nowrap class="line-data " id="LC346">	<span class="n">bfq_insert</span><span class="p">(</span><span class="o">&amp;</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">active</span><span class="p">,</span> <span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID347" rel="#L347">347</td>
          <td nowrap class="line-data " id="LC347"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID348" rel="#L348">348</td>
          <td nowrap class="line-data " id="LC348">	<span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">rb_left</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID349" rel="#L349">349</td>
          <td nowrap class="line-data " id="LC349">		<span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">rb_left</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID350" rel="#L350">350</td>
          <td nowrap class="line-data " id="LC350">	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">rb_right</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID351" rel="#L351">351</td>
          <td nowrap class="line-data " id="LC351">		<span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">rb_right</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID352" rel="#L352">352</td>
          <td nowrap class="line-data " id="LC352"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID353" rel="#L353">353</td>
          <td nowrap class="line-data " id="LC353">	<span class="n">bfq_update_active_tree</span><span class="p">(</span><span class="n">node</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID354" rel="#L354">354</td>
          <td nowrap class="line-data " id="LC354"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID355" rel="#L355">355</td>
          <td nowrap class="line-data " id="LC355">	<span class="k">if</span> <span class="p">(</span><span class="n">bfqq</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID356" rel="#L356">356</td>
          <td nowrap class="line-data " id="LC356">		<span class="n">list_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bfqq</span><span class="o">-&gt;</span><span class="n">bfqq_list</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">bfqq</span><span class="o">-&gt;</span><span class="n">bfqd</span><span class="o">-&gt;</span><span class="n">active_list</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID357" rel="#L357">357</td>
          <td nowrap class="line-data " id="LC357"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID358" rel="#L358">358</td>
          <td nowrap class="line-data " id="LC358"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID359" rel="#L359">359</td>
          <td nowrap class="line-data " id="LC359"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID360" rel="#L360">360</td>
          <td nowrap class="line-data " id="LC360"><span class="cm"> * bfq_ioprio_to_weight - calc a weight from an ioprio.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID361" rel="#L361">361</td>
          <td nowrap class="line-data " id="LC361"><span class="cm"> * @ioprio: the ioprio value to convert.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID362" rel="#L362">362</td>
          <td nowrap class="line-data " id="LC362"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID363" rel="#L363">363</td>
          <td nowrap class="line-data " id="LC363"><span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="nf">bfq_ioprio_to_weight</span><span class="p">(</span><span class="kt">int</span> <span class="n">ioprio</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID364" rel="#L364">364</td>
          <td nowrap class="line-data " id="LC364"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID365" rel="#L365">365</td>
          <td nowrap class="line-data " id="LC365">	<span class="n">WARN_ON</span><span class="p">(</span><span class="n">ioprio</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">ioprio</span> <span class="o">&gt;=</span> <span class="n">IOPRIO_BE_NR</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID366" rel="#L366">366</td>
          <td nowrap class="line-data " id="LC366">	<span class="k">return</span> <span class="n">IOPRIO_BE_NR</span> <span class="o">-</span> <span class="n">ioprio</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID367" rel="#L367">367</td>
          <td nowrap class="line-data " id="LC367"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID368" rel="#L368">368</td>
          <td nowrap class="line-data " id="LC368"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID369" rel="#L369">369</td>
          <td nowrap class="line-data " id="LC369"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID370" rel="#L370">370</td>
          <td nowrap class="line-data " id="LC370"><span class="cm"> * bfq_weight_to_ioprio - calc an ioprio from a weight.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID371" rel="#L371">371</td>
          <td nowrap class="line-data " id="LC371"><span class="cm"> * @weight: the weight value to convert.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID372" rel="#L372">372</td>
          <td nowrap class="line-data " id="LC372"><span class="cm"> *</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID373" rel="#L373">373</td>
          <td nowrap class="line-data " id="LC373"><span class="cm"> * To preserve as mush as possible the old only-ioprio user interface,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID374" rel="#L374">374</td>
          <td nowrap class="line-data " id="LC374"><span class="cm"> * 0 is used as an escape ioprio value for weights (numerically) equal or</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID375" rel="#L375">375</td>
          <td nowrap class="line-data " id="LC375"><span class="cm"> * larger than IOPRIO_BE_NR</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID376" rel="#L376">376</td>
          <td nowrap class="line-data " id="LC376"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID377" rel="#L377">377</td>
          <td nowrap class="line-data " id="LC377"><span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="nf">bfq_weight_to_ioprio</span><span class="p">(</span><span class="kt">int</span> <span class="n">weight</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID378" rel="#L378">378</td>
          <td nowrap class="line-data " id="LC378"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID379" rel="#L379">379</td>
          <td nowrap class="line-data " id="LC379">	<span class="n">WARN_ON</span><span class="p">(</span><span class="n">weight</span> <span class="o">&lt;</span> <span class="n">BFQ_MIN_WEIGHT</span> <span class="o">||</span> <span class="n">weight</span> <span class="o">&gt;</span> <span class="n">BFQ_MAX_WEIGHT</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID380" rel="#L380">380</td>
          <td nowrap class="line-data " id="LC380">	<span class="k">return</span> <span class="n">IOPRIO_BE_NR</span> <span class="o">-</span> <span class="n">weight</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">IOPRIO_BE_NR</span> <span class="o">-</span> <span class="n">weight</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID381" rel="#L381">381</td>
          <td nowrap class="line-data " id="LC381"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID382" rel="#L382">382</td>
          <td nowrap class="line-data " id="LC382"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID383" rel="#L383">383</td>
          <td nowrap class="line-data " id="LC383"><span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">bfq_get_entity</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID384" rel="#L384">384</td>
          <td nowrap class="line-data " id="LC384"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID385" rel="#L385">385</td>
          <td nowrap class="line-data " id="LC385">	<span class="k">struct</span> <span class="n">bfq_queue</span> <span class="o">*</span><span class="n">bfqq</span> <span class="o">=</span> <span class="n">bfq_entity_to_bfqq</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID386" rel="#L386">386</td>
          <td nowrap class="line-data " id="LC386"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID387" rel="#L387">387</td>
          <td nowrap class="line-data " id="LC387">	<span class="k">if</span> <span class="p">(</span><span class="n">bfqq</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID388" rel="#L388">388</td>
          <td nowrap class="line-data " id="LC388">		<span class="n">atomic_inc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bfqq</span><span class="o">-&gt;</span><span class="n">ref</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID389" rel="#L389">389</td>
          <td nowrap class="line-data " id="LC389">		<span class="n">bfq_log_bfqq</span><span class="p">(</span><span class="n">bfqq</span><span class="o">-&gt;</span><span class="n">bfqd</span><span class="p">,</span> <span class="n">bfqq</span><span class="p">,</span> <span class="s">&quot;get_entity: %p %d&quot;</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID390" rel="#L390">390</td>
          <td nowrap class="line-data " id="LC390">			     <span class="n">bfqq</span><span class="p">,</span> <span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bfqq</span><span class="o">-&gt;</span><span class="n">ref</span><span class="p">));</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID391" rel="#L391">391</td>
          <td nowrap class="line-data " id="LC391">	<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID392" rel="#L392">392</td>
          <td nowrap class="line-data " id="LC392"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID393" rel="#L393">393</td>
          <td nowrap class="line-data " id="LC393"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID394" rel="#L394">394</td>
          <td nowrap class="line-data " id="LC394"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID395" rel="#L395">395</td>
          <td nowrap class="line-data " id="LC395"><span class="cm"> * bfq_find_deepest - find the deepest node that an extraction can modify.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID396" rel="#L396">396</td>
          <td nowrap class="line-data " id="LC396"><span class="cm"> * @node: the node being removed.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID397" rel="#L397">397</td>
          <td nowrap class="line-data " id="LC397"><span class="cm"> *</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID398" rel="#L398">398</td>
          <td nowrap class="line-data " id="LC398"><span class="cm"> * Do the first step of an extraction in an rb tree, looking for the</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID399" rel="#L399">399</td>
          <td nowrap class="line-data " id="LC399"><span class="cm"> * node that will replace @node, and returning the deepest node that</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID400" rel="#L400">400</td>
          <td nowrap class="line-data " id="LC400"><span class="cm"> * the following modifications to the tree can touch.  If @node is the</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID401" rel="#L401">401</td>
          <td nowrap class="line-data " id="LC401"><span class="cm"> * last node in the tree return %NULL.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID402" rel="#L402">402</td>
          <td nowrap class="line-data " id="LC402"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID403" rel="#L403">403</td>
          <td nowrap class="line-data " id="LC403"><span class="k">static</span> <span class="k">struct</span> <span class="n">rb_node</span> <span class="o">*</span><span class="nf">bfq_find_deepest</span><span class="p">(</span><span class="k">struct</span> <span class="n">rb_node</span> <span class="o">*</span><span class="n">node</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID404" rel="#L404">404</td>
          <td nowrap class="line-data " id="LC404"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID405" rel="#L405">405</td>
          <td nowrap class="line-data " id="LC405">	<span class="k">struct</span> <span class="n">rb_node</span> <span class="o">*</span><span class="n">deepest</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID406" rel="#L406">406</td>
          <td nowrap class="line-data " id="LC406"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID407" rel="#L407">407</td>
          <td nowrap class="line-data " id="LC407">	<span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">rb_right</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">&amp;&amp;</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">rb_left</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID408" rel="#L408">408</td>
          <td nowrap class="line-data " id="LC408">		<span class="n">deepest</span> <span class="o">=</span> <span class="n">rb_parent</span><span class="p">(</span><span class="n">node</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID409" rel="#L409">409</td>
          <td nowrap class="line-data " id="LC409">	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">rb_right</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID410" rel="#L410">410</td>
          <td nowrap class="line-data " id="LC410">		<span class="n">deepest</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">rb_left</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID411" rel="#L411">411</td>
          <td nowrap class="line-data " id="LC411">	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">rb_left</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID412" rel="#L412">412</td>
          <td nowrap class="line-data " id="LC412">		<span class="n">deepest</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">rb_right</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID413" rel="#L413">413</td>
          <td nowrap class="line-data " id="LC413">	<span class="k">else</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID414" rel="#L414">414</td>
          <td nowrap class="line-data " id="LC414">		<span class="n">deepest</span> <span class="o">=</span> <span class="n">rb_next</span><span class="p">(</span><span class="n">node</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID415" rel="#L415">415</td>
          <td nowrap class="line-data " id="LC415">		<span class="k">if</span> <span class="p">(</span><span class="n">deepest</span><span class="o">-&gt;</span><span class="n">rb_right</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID416" rel="#L416">416</td>
          <td nowrap class="line-data " id="LC416">			<span class="n">deepest</span> <span class="o">=</span> <span class="n">deepest</span><span class="o">-&gt;</span><span class="n">rb_right</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID417" rel="#L417">417</td>
          <td nowrap class="line-data " id="LC417">		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">rb_parent</span><span class="p">(</span><span class="n">deepest</span><span class="p">)</span> <span class="o">!=</span> <span class="n">node</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID418" rel="#L418">418</td>
          <td nowrap class="line-data " id="LC418">			<span class="n">deepest</span> <span class="o">=</span> <span class="n">rb_parent</span><span class="p">(</span><span class="n">deepest</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID419" rel="#L419">419</td>
          <td nowrap class="line-data " id="LC419">	<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID420" rel="#L420">420</td>
          <td nowrap class="line-data " id="LC420"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID421" rel="#L421">421</td>
          <td nowrap class="line-data " id="LC421">	<span class="k">return</span> <span class="n">deepest</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID422" rel="#L422">422</td>
          <td nowrap class="line-data " id="LC422"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID423" rel="#L423">423</td>
          <td nowrap class="line-data " id="LC423"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID424" rel="#L424">424</td>
          <td nowrap class="line-data " id="LC424"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID425" rel="#L425">425</td>
          <td nowrap class="line-data " id="LC425"><span class="cm"> * bfq_active_extract - remove an entity from the active tree.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID426" rel="#L426">426</td>
          <td nowrap class="line-data " id="LC426"><span class="cm"> * @st: the service_tree containing the tree.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID427" rel="#L427">427</td>
          <td nowrap class="line-data " id="LC427"><span class="cm"> * @entity: the entity being removed.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID428" rel="#L428">428</td>
          <td nowrap class="line-data " id="LC428"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID429" rel="#L429">429</td>
          <td nowrap class="line-data " id="LC429"><span class="k">static</span> <span class="kt">void</span> <span class="nf">bfq_active_extract</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_service_tree</span> <span class="o">*</span><span class="n">st</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID430" rel="#L430">430</td>
          <td nowrap class="line-data " id="LC430">			       <span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID431" rel="#L431">431</td>
          <td nowrap class="line-data " id="LC431"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID432" rel="#L432">432</td>
          <td nowrap class="line-data " id="LC432">	<span class="k">struct</span> <span class="n">bfq_queue</span> <span class="o">*</span><span class="n">bfqq</span> <span class="o">=</span> <span class="n">bfq_entity_to_bfqq</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID433" rel="#L433">433</td>
          <td nowrap class="line-data " id="LC433">	<span class="k">struct</span> <span class="n">rb_node</span> <span class="o">*</span><span class="n">node</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID434" rel="#L434">434</td>
          <td nowrap class="line-data " id="LC434"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID435" rel="#L435">435</td>
          <td nowrap class="line-data " id="LC435">	<span class="n">node</span> <span class="o">=</span> <span class="n">bfq_find_deepest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">rb_node</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID436" rel="#L436">436</td>
          <td nowrap class="line-data " id="LC436">	<span class="n">bfq_extract</span><span class="p">(</span><span class="o">&amp;</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">active</span><span class="p">,</span> <span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID437" rel="#L437">437</td>
          <td nowrap class="line-data " id="LC437"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID438" rel="#L438">438</td>
          <td nowrap class="line-data " id="LC438">	<span class="k">if</span> <span class="p">(</span><span class="n">node</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID439" rel="#L439">439</td>
          <td nowrap class="line-data " id="LC439">		<span class="n">bfq_update_active_tree</span><span class="p">(</span><span class="n">node</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID440" rel="#L440">440</td>
          <td nowrap class="line-data " id="LC440"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID441" rel="#L441">441</td>
          <td nowrap class="line-data " id="LC441">	<span class="k">if</span> <span class="p">(</span><span class="n">bfqq</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID442" rel="#L442">442</td>
          <td nowrap class="line-data " id="LC442">		<span class="n">list_del</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bfqq</span><span class="o">-&gt;</span><span class="n">bfqq_list</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID443" rel="#L443">443</td>
          <td nowrap class="line-data " id="LC443"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID444" rel="#L444">444</td>
          <td nowrap class="line-data " id="LC444"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID445" rel="#L445">445</td>
          <td nowrap class="line-data " id="LC445"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID446" rel="#L446">446</td>
          <td nowrap class="line-data " id="LC446"><span class="cm"> * bfq_idle_insert - insert an entity into the idle tree.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID447" rel="#L447">447</td>
          <td nowrap class="line-data " id="LC447"><span class="cm"> * @st: the service tree containing the tree.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID448" rel="#L448">448</td>
          <td nowrap class="line-data " id="LC448"><span class="cm"> * @entity: the entity to insert.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID449" rel="#L449">449</td>
          <td nowrap class="line-data " id="LC449"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID450" rel="#L450">450</td>
          <td nowrap class="line-data " id="LC450"><span class="k">static</span> <span class="kt">void</span> <span class="nf">bfq_idle_insert</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_service_tree</span> <span class="o">*</span><span class="n">st</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID451" rel="#L451">451</td>
          <td nowrap class="line-data " id="LC451">			    <span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID452" rel="#L452">452</td>
          <td nowrap class="line-data " id="LC452"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID453" rel="#L453">453</td>
          <td nowrap class="line-data " id="LC453">	<span class="k">struct</span> <span class="n">bfq_queue</span> <span class="o">*</span><span class="n">bfqq</span> <span class="o">=</span> <span class="n">bfq_entity_to_bfqq</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID454" rel="#L454">454</td>
          <td nowrap class="line-data " id="LC454">	<span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">first_idle</span> <span class="o">=</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">first_idle</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID455" rel="#L455">455</td>
          <td nowrap class="line-data " id="LC455">	<span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">last_idle</span> <span class="o">=</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">last_idle</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID456" rel="#L456">456</td>
          <td nowrap class="line-data " id="LC456"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID457" rel="#L457">457</td>
          <td nowrap class="line-data " id="LC457">	<span class="k">if</span> <span class="p">(</span><span class="n">first_idle</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="n">bfq_gt</span><span class="p">(</span><span class="n">first_idle</span><span class="o">-&gt;</span><span class="n">finish</span><span class="p">,</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">finish</span><span class="p">))</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID458" rel="#L458">458</td>
          <td nowrap class="line-data " id="LC458">		<span class="n">st</span><span class="o">-&gt;</span><span class="n">first_idle</span> <span class="o">=</span> <span class="n">entity</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID459" rel="#L459">459</td>
          <td nowrap class="line-data " id="LC459">	<span class="k">if</span> <span class="p">(</span><span class="n">last_idle</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="n">bfq_gt</span><span class="p">(</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">finish</span><span class="p">,</span> <span class="n">last_idle</span><span class="o">-&gt;</span><span class="n">finish</span><span class="p">))</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID460" rel="#L460">460</td>
          <td nowrap class="line-data " id="LC460">		<span class="n">st</span><span class="o">-&gt;</span><span class="n">last_idle</span> <span class="o">=</span> <span class="n">entity</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID461" rel="#L461">461</td>
          <td nowrap class="line-data " id="LC461"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID462" rel="#L462">462</td>
          <td nowrap class="line-data " id="LC462">	<span class="n">bfq_insert</span><span class="p">(</span><span class="o">&amp;</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">idle</span><span class="p">,</span> <span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID463" rel="#L463">463</td>
          <td nowrap class="line-data " id="LC463"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID464" rel="#L464">464</td>
          <td nowrap class="line-data " id="LC464">	<span class="k">if</span> <span class="p">(</span><span class="n">bfqq</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID465" rel="#L465">465</td>
          <td nowrap class="line-data " id="LC465">		<span class="n">list_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bfqq</span><span class="o">-&gt;</span><span class="n">bfqq_list</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">bfqq</span><span class="o">-&gt;</span><span class="n">bfqd</span><span class="o">-&gt;</span><span class="n">idle_list</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID466" rel="#L466">466</td>
          <td nowrap class="line-data " id="LC466"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID467" rel="#L467">467</td>
          <td nowrap class="line-data " id="LC467"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID468" rel="#L468">468</td>
          <td nowrap class="line-data " id="LC468"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID469" rel="#L469">469</td>
          <td nowrap class="line-data " id="LC469"><span class="cm"> * bfq_forget_entity - remove an entity from the wfq trees.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID470" rel="#L470">470</td>
          <td nowrap class="line-data " id="LC470"><span class="cm"> * @st: the service tree.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID471" rel="#L471">471</td>
          <td nowrap class="line-data " id="LC471"><span class="cm"> * @entity: the entity being removed.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID472" rel="#L472">472</td>
          <td nowrap class="line-data " id="LC472"><span class="cm"> *</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID473" rel="#L473">473</td>
          <td nowrap class="line-data " id="LC473"><span class="cm"> * Update the device status and forget everything about @entity, putting</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID474" rel="#L474">474</td>
          <td nowrap class="line-data " id="LC474"><span class="cm"> * the device reference to it, if it is a queue.  Entities belonging to</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID475" rel="#L475">475</td>
          <td nowrap class="line-data " id="LC475"><span class="cm"> * groups are not refcounted.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID476" rel="#L476">476</td>
          <td nowrap class="line-data " id="LC476"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID477" rel="#L477">477</td>
          <td nowrap class="line-data " id="LC477"><span class="k">static</span> <span class="kt">void</span> <span class="nf">bfq_forget_entity</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_service_tree</span> <span class="o">*</span><span class="n">st</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID478" rel="#L478">478</td>
          <td nowrap class="line-data " id="LC478">			      <span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID479" rel="#L479">479</td>
          <td nowrap class="line-data " id="LC479"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID480" rel="#L480">480</td>
          <td nowrap class="line-data " id="LC480">	<span class="k">struct</span> <span class="n">bfq_queue</span> <span class="o">*</span><span class="n">bfqq</span> <span class="o">=</span> <span class="n">bfq_entity_to_bfqq</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID481" rel="#L481">481</td>
          <td nowrap class="line-data " id="LC481"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID482" rel="#L482">482</td>
          <td nowrap class="line-data " id="LC482">	<span class="n">BUG_ON</span><span class="p">(</span><span class="o">!</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">on_st</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID483" rel="#L483">483</td>
          <td nowrap class="line-data " id="LC483"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID484" rel="#L484">484</td>
          <td nowrap class="line-data " id="LC484">	<span class="n">entity</span><span class="o">-&gt;</span><span class="n">on_st</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID485" rel="#L485">485</td>
          <td nowrap class="line-data " id="LC485">	<span class="n">st</span><span class="o">-&gt;</span><span class="n">wsum</span> <span class="o">-=</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">weight</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID486" rel="#L486">486</td>
          <td nowrap class="line-data " id="LC486">	<span class="k">if</span> <span class="p">(</span><span class="n">bfqq</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID487" rel="#L487">487</td>
          <td nowrap class="line-data " id="LC487">		<span class="n">bfq_log_bfqq</span><span class="p">(</span><span class="n">bfqq</span><span class="o">-&gt;</span><span class="n">bfqd</span><span class="p">,</span> <span class="n">bfqq</span><span class="p">,</span> <span class="s">&quot;forget_entity: %p %d&quot;</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID488" rel="#L488">488</td>
          <td nowrap class="line-data " id="LC488">			     <span class="n">bfqq</span><span class="p">,</span> <span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bfqq</span><span class="o">-&gt;</span><span class="n">ref</span><span class="p">));</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID489" rel="#L489">489</td>
          <td nowrap class="line-data " id="LC489">		<span class="n">bfq_put_queue</span><span class="p">(</span><span class="n">bfqq</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID490" rel="#L490">490</td>
          <td nowrap class="line-data " id="LC490">	<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID491" rel="#L491">491</td>
          <td nowrap class="line-data " id="LC491"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID492" rel="#L492">492</td>
          <td nowrap class="line-data " id="LC492"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID493" rel="#L493">493</td>
          <td nowrap class="line-data " id="LC493"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID494" rel="#L494">494</td>
          <td nowrap class="line-data " id="LC494"><span class="cm"> * bfq_put_idle_entity - release the idle tree ref of an entity.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID495" rel="#L495">495</td>
          <td nowrap class="line-data " id="LC495"><span class="cm"> * @st: service tree for the entity.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID496" rel="#L496">496</td>
          <td nowrap class="line-data " id="LC496"><span class="cm"> * @entity: the entity being released.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID497" rel="#L497">497</td>
          <td nowrap class="line-data " id="LC497"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID498" rel="#L498">498</td>
          <td nowrap class="line-data " id="LC498"><span class="k">static</span> <span class="kt">void</span> <span class="nf">bfq_put_idle_entity</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_service_tree</span> <span class="o">*</span><span class="n">st</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID499" rel="#L499">499</td>
          <td nowrap class="line-data " id="LC499">				<span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID500" rel="#L500">500</td>
          <td nowrap class="line-data " id="LC500"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID501" rel="#L501">501</td>
          <td nowrap class="line-data " id="LC501">	<span class="n">bfq_idle_extract</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID502" rel="#L502">502</td>
          <td nowrap class="line-data " id="LC502">	<span class="n">bfq_forget_entity</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID503" rel="#L503">503</td>
          <td nowrap class="line-data " id="LC503"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID504" rel="#L504">504</td>
          <td nowrap class="line-data " id="LC504"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID505" rel="#L505">505</td>
          <td nowrap class="line-data " id="LC505"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID506" rel="#L506">506</td>
          <td nowrap class="line-data " id="LC506"><span class="cm"> * bfq_forget_idle - update the idle tree if necessary.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID507" rel="#L507">507</td>
          <td nowrap class="line-data " id="LC507"><span class="cm"> * @st: the service tree to act upon.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID508" rel="#L508">508</td>
          <td nowrap class="line-data " id="LC508"><span class="cm"> *</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID509" rel="#L509">509</td>
          <td nowrap class="line-data " id="LC509"><span class="cm"> * To preserve the global O(log N) complexity we only remove one entry here;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID510" rel="#L510">510</td>
          <td nowrap class="line-data " id="LC510"><span class="cm"> * as the idle tree will not grow indefinitely this can be done safely.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID511" rel="#L511">511</td>
          <td nowrap class="line-data " id="LC511"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID512" rel="#L512">512</td>
          <td nowrap class="line-data " id="LC512"><span class="k">static</span> <span class="kt">void</span> <span class="nf">bfq_forget_idle</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_service_tree</span> <span class="o">*</span><span class="n">st</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID513" rel="#L513">513</td>
          <td nowrap class="line-data " id="LC513"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID514" rel="#L514">514</td>
          <td nowrap class="line-data " id="LC514">	<span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">first_idle</span> <span class="o">=</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">first_idle</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID515" rel="#L515">515</td>
          <td nowrap class="line-data " id="LC515">	<span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">last_idle</span> <span class="o">=</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">last_idle</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID516" rel="#L516">516</td>
          <td nowrap class="line-data " id="LC516"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID517" rel="#L517">517</td>
          <td nowrap class="line-data " id="LC517">	<span class="k">if</span> <span class="p">(</span><span class="n">RB_EMPTY_ROOT</span><span class="p">(</span><span class="o">&amp;</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">active</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">last_idle</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="o">&amp;&amp;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID518" rel="#L518">518</td>
          <td nowrap class="line-data " id="LC518">	    <span class="o">!</span><span class="n">bfq_gt</span><span class="p">(</span><span class="n">last_idle</span><span class="o">-&gt;</span><span class="n">finish</span><span class="p">,</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">vtime</span><span class="p">))</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID519" rel="#L519">519</td>
          <td nowrap class="line-data " id="LC519">		<span class="cm">/*</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID520" rel="#L520">520</td>
          <td nowrap class="line-data " id="LC520"><span class="cm">		 * Forget the whole idle tree, increasing the vtime past</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID521" rel="#L521">521</td>
          <td nowrap class="line-data " id="LC521"><span class="cm">		 * the last finish time of idle entities.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID522" rel="#L522">522</td>
          <td nowrap class="line-data " id="LC522"><span class="cm">		 */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID523" rel="#L523">523</td>
          <td nowrap class="line-data " id="LC523">		<span class="n">st</span><span class="o">-&gt;</span><span class="n">vtime</span> <span class="o">=</span> <span class="n">last_idle</span><span class="o">-&gt;</span><span class="n">finish</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID524" rel="#L524">524</td>
          <td nowrap class="line-data " id="LC524">	<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID525" rel="#L525">525</td>
          <td nowrap class="line-data " id="LC525"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID526" rel="#L526">526</td>
          <td nowrap class="line-data " id="LC526">	<span class="k">if</span> <span class="p">(</span><span class="n">first_idle</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">bfq_gt</span><span class="p">(</span><span class="n">first_idle</span><span class="o">-&gt;</span><span class="n">finish</span><span class="p">,</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">vtime</span><span class="p">))</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID527" rel="#L527">527</td>
          <td nowrap class="line-data " id="LC527">		<span class="n">bfq_put_idle_entity</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="n">first_idle</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID528" rel="#L528">528</td>
          <td nowrap class="line-data " id="LC528"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID529" rel="#L529">529</td>
          <td nowrap class="line-data " id="LC529"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID530" rel="#L530">530</td>
          <td nowrap class="line-data " id="LC530"><span class="k">static</span> <span class="k">struct</span> <span class="n">bfq_service_tree</span> <span class="o">*</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID531" rel="#L531">531</td>
          <td nowrap class="line-data " id="LC531"><span class="nf">__bfq_entity_update_weight_prio</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_service_tree</span> <span class="o">*</span><span class="n">old_st</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID532" rel="#L532">532</td>
          <td nowrap class="line-data " id="LC532">			 <span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID533" rel="#L533">533</td>
          <td nowrap class="line-data " id="LC533"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID534" rel="#L534">534</td>
          <td nowrap class="line-data " id="LC534">	<span class="k">struct</span> <span class="n">bfq_service_tree</span> <span class="o">*</span><span class="n">new_st</span> <span class="o">=</span> <span class="n">old_st</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID535" rel="#L535">535</td>
          <td nowrap class="line-data " id="LC535"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID536" rel="#L536">536</td>
          <td nowrap class="line-data " id="LC536">	<span class="k">if</span> <span class="p">(</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">ioprio_changed</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID537" rel="#L537">537</td>
          <td nowrap class="line-data " id="LC537">		<span class="k">struct</span> <span class="n">bfq_queue</span> <span class="o">*</span><span class="n">bfqq</span> <span class="o">=</span> <span class="n">bfq_entity_to_bfqq</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID538" rel="#L538">538</td>
          <td nowrap class="line-data " id="LC538"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID539" rel="#L539">539</td>
          <td nowrap class="line-data " id="LC539">		<span class="n">BUG_ON</span><span class="p">(</span><span class="n">old_st</span><span class="o">-&gt;</span><span class="n">wsum</span> <span class="o">&lt;</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">weight</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID540" rel="#L540">540</td>
          <td nowrap class="line-data " id="LC540">		<span class="n">old_st</span><span class="o">-&gt;</span><span class="n">wsum</span> <span class="o">-=</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">weight</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID541" rel="#L541">541</td>
          <td nowrap class="line-data " id="LC541"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID542" rel="#L542">542</td>
          <td nowrap class="line-data " id="LC542">		<span class="k">if</span> <span class="p">(</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">new_weight</span> <span class="o">!=</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">orig_weight</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID543" rel="#L543">543</td>
          <td nowrap class="line-data " id="LC543">			<span class="n">entity</span><span class="o">-&gt;</span><span class="n">orig_weight</span> <span class="o">=</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">new_weight</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID544" rel="#L544">544</td>
          <td nowrap class="line-data " id="LC544">			<span class="n">entity</span><span class="o">-&gt;</span><span class="n">ioprio</span> <span class="o">=</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID545" rel="#L545">545</td>
          <td nowrap class="line-data " id="LC545">				<span class="n">bfq_weight_to_ioprio</span><span class="p">(</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">orig_weight</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID546" rel="#L546">546</td>
          <td nowrap class="line-data " id="LC546">		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">new_ioprio</span> <span class="o">!=</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">ioprio</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID547" rel="#L547">547</td>
          <td nowrap class="line-data " id="LC547">			<span class="n">entity</span><span class="o">-&gt;</span><span class="n">ioprio</span> <span class="o">=</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">new_ioprio</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID548" rel="#L548">548</td>
          <td nowrap class="line-data " id="LC548">			<span class="n">entity</span><span class="o">-&gt;</span><span class="n">orig_weight</span> <span class="o">=</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID549" rel="#L549">549</td>
          <td nowrap class="line-data " id="LC549">					<span class="n">bfq_ioprio_to_weight</span><span class="p">(</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">ioprio</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID550" rel="#L550">550</td>
          <td nowrap class="line-data " id="LC550">		<span class="p">}</span> <span class="k">else</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID551" rel="#L551">551</td>
          <td nowrap class="line-data " id="LC551">			<span class="n">entity</span><span class="o">-&gt;</span><span class="n">new_weight</span> <span class="o">=</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">orig_weight</span> <span class="o">=</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID552" rel="#L552">552</td>
          <td nowrap class="line-data " id="LC552">				<span class="n">bfq_ioprio_to_weight</span><span class="p">(</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">ioprio</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID553" rel="#L553">553</td>
          <td nowrap class="line-data " id="LC553"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID554" rel="#L554">554</td>
          <td nowrap class="line-data " id="LC554">		<span class="n">entity</span><span class="o">-&gt;</span><span class="n">ioprio_class</span> <span class="o">=</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">new_ioprio_class</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID555" rel="#L555">555</td>
          <td nowrap class="line-data " id="LC555">		<span class="n">entity</span><span class="o">-&gt;</span><span class="n">ioprio_changed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID556" rel="#L556">556</td>
          <td nowrap class="line-data " id="LC556"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID557" rel="#L557">557</td>
          <td nowrap class="line-data " id="LC557">		<span class="cm">/*</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID558" rel="#L558">558</td>
          <td nowrap class="line-data " id="LC558"><span class="cm">		 * NOTE: here we may be changing the weight too early,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID559" rel="#L559">559</td>
          <td nowrap class="line-data " id="LC559"><span class="cm">		 * this will cause unfairness.  The correct approach</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID560" rel="#L560">560</td>
          <td nowrap class="line-data " id="LC560"><span class="cm">		 * would have required additional complexity to defer</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID561" rel="#L561">561</td>
          <td nowrap class="line-data " id="LC561"><span class="cm">		 * weight changes to the proper time instants (i.e.,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID562" rel="#L562">562</td>
          <td nowrap class="line-data " id="LC562"><span class="cm">		 * when entity-&gt;finish &lt;= old_st-&gt;vtime).</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID563" rel="#L563">563</td>
          <td nowrap class="line-data " id="LC563"><span class="cm">		 */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID564" rel="#L564">564</td>
          <td nowrap class="line-data " id="LC564">		<span class="n">new_st</span> <span class="o">=</span> <span class="n">bfq_entity_service_tree</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID565" rel="#L565">565</td>
          <td nowrap class="line-data " id="LC565">		<span class="n">entity</span><span class="o">-&gt;</span><span class="n">weight</span> <span class="o">=</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">orig_weight</span> <span class="o">*</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID566" rel="#L566">566</td>
          <td nowrap class="line-data " id="LC566">			<span class="p">(</span><span class="n">bfqq</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="o">?</span> <span class="n">bfqq</span><span class="o">-&gt;</span><span class="n">raising_coeff</span> <span class="o">:</span> <span class="mi">1</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID567" rel="#L567">567</td>
          <td nowrap class="line-data " id="LC567">		<span class="n">new_st</span><span class="o">-&gt;</span><span class="n">wsum</span> <span class="o">+=</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">weight</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID568" rel="#L568">568</td>
          <td nowrap class="line-data " id="LC568"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID569" rel="#L569">569</td>
          <td nowrap class="line-data " id="LC569">		<span class="k">if</span> <span class="p">(</span><span class="n">new_st</span> <span class="o">!=</span> <span class="n">old_st</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID570" rel="#L570">570</td>
          <td nowrap class="line-data " id="LC570">			<span class="n">entity</span><span class="o">-&gt;</span><span class="n">start</span> <span class="o">=</span> <span class="n">new_st</span><span class="o">-&gt;</span><span class="n">vtime</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID571" rel="#L571">571</td>
          <td nowrap class="line-data " id="LC571">	<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID572" rel="#L572">572</td>
          <td nowrap class="line-data " id="LC572"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID573" rel="#L573">573</td>
          <td nowrap class="line-data " id="LC573">	<span class="k">return</span> <span class="n">new_st</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID574" rel="#L574">574</td>
          <td nowrap class="line-data " id="LC574"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID575" rel="#L575">575</td>
          <td nowrap class="line-data " id="LC575"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID576" rel="#L576">576</td>
          <td nowrap class="line-data " id="LC576"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID577" rel="#L577">577</td>
          <td nowrap class="line-data " id="LC577"><span class="cm"> * bfq_bfqq_served - update the scheduler status after selection for service.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID578" rel="#L578">578</td>
          <td nowrap class="line-data " id="LC578"><span class="cm"> * @bfqq: the queue being served.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID579" rel="#L579">579</td>
          <td nowrap class="line-data " id="LC579"><span class="cm"> * @served: bytes to transfer.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID580" rel="#L580">580</td>
          <td nowrap class="line-data " id="LC580"><span class="cm"> *</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID581" rel="#L581">581</td>
          <td nowrap class="line-data " id="LC581"><span class="cm"> * NOTE: this can be optimized, as the timestamps of upper level entities</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID582" rel="#L582">582</td>
          <td nowrap class="line-data " id="LC582"><span class="cm"> * are synchronized every time a new bfqq is selected for service.  By now,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID583" rel="#L583">583</td>
          <td nowrap class="line-data " id="LC583"><span class="cm"> * we keep it to better check consistency.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID584" rel="#L584">584</td>
          <td nowrap class="line-data " id="LC584"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID585" rel="#L585">585</td>
          <td nowrap class="line-data " id="LC585"><span class="k">static</span> <span class="kt">void</span> <span class="nf">bfq_bfqq_served</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_queue</span> <span class="o">*</span><span class="n">bfqq</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">served</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID586" rel="#L586">586</td>
          <td nowrap class="line-data " id="LC586"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID587" rel="#L587">587</td>
          <td nowrap class="line-data " id="LC587">	<span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bfqq</span><span class="o">-&gt;</span><span class="n">entity</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID588" rel="#L588">588</td>
          <td nowrap class="line-data " id="LC588">	<span class="k">struct</span> <span class="n">bfq_service_tree</span> <span class="o">*</span><span class="n">st</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID589" rel="#L589">589</td>
          <td nowrap class="line-data " id="LC589"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID590" rel="#L590">590</td>
          <td nowrap class="line-data " id="LC590">	<span class="n">for_each_entity</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID591" rel="#L591">591</td>
          <td nowrap class="line-data " id="LC591">		<span class="n">st</span> <span class="o">=</span> <span class="n">bfq_entity_service_tree</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID592" rel="#L592">592</td>
          <td nowrap class="line-data " id="LC592"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID593" rel="#L593">593</td>
          <td nowrap class="line-data " id="LC593">		<span class="n">entity</span><span class="o">-&gt;</span><span class="n">service</span> <span class="o">+=</span> <span class="n">served</span><span class="p">;</span></td>
        </tr>
            <tr class="section-first">
            <td nowrap class="commitinfo">
              <code>
                <a href="/MikeC84/android_kernel_htc_shooter/commit/e365591c6cacf807a865d078e5794d0245d603a4">e365591c</a>
                <a href="/MikeC84/android_kernel_htc_shooter/blame/e365591c6cacf807a865d078e5794d0245d603a4/block/bfq-sched.c">&#187;</a>
                <a href="/MikeC84">MikeC84</a>
              </code>
              <br />
              <span class="date">2012-08-20</span>
              <span class="message" title="Update BFQ Scheduler to v4">Update BFQ Scheduler to v4 </span>
            </td>
          <td nowrap class="line-number" id="LID594" rel="#L594">594</td>
          <td nowrap class="line-data " id="LC594">		<span class="n">BUG_ON</span><span class="p">(</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">service</span> <span class="o">&gt;</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">budget</span><span class="p">);</span></td>
        </tr>
            <tr class="section-first">
            <td nowrap class="commitinfo">
              <code>
                <a href="/MikeC84/android_kernel_htc_shooter/commit/8540bba587cf4e5fbcecf0f5184f69d627fee7cd">8540bba5</a>
                <a href="/MikeC84/android_kernel_htc_shooter/blame/8540bba587cf4e5fbcecf0f5184f69d627fee7cd/block/bfq-sched.c">&#187;</a>
                <a href="/MikeC84">MikeC84</a>
              </code>
              <br />
              <span class="date">2012-07-24</span>
              <span class="message" title="Add BFQ IO Scheduler">Add BFQ IO Scheduler </span>
            </td>
          <td nowrap class="line-number" id="LID595" rel="#L595">595</td>
          <td nowrap class="line-data " id="LC595">		<span class="n">BUG_ON</span><span class="p">(</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">wsum</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID596" rel="#L596">596</td>
          <td nowrap class="line-data " id="LC596"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID597" rel="#L597">597</td>
          <td nowrap class="line-data " id="LC597">		<span class="n">st</span><span class="o">-&gt;</span><span class="n">vtime</span> <span class="o">+=</span> <span class="n">bfq_delta</span><span class="p">(</span><span class="n">served</span><span class="p">,</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">wsum</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID598" rel="#L598">598</td>
          <td nowrap class="line-data " id="LC598">		<span class="n">bfq_forget_idle</span><span class="p">(</span><span class="n">st</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID599" rel="#L599">599</td>
          <td nowrap class="line-data " id="LC599">	<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID600" rel="#L600">600</td>
          <td nowrap class="line-data " id="LC600">	<span class="n">bfq_log_bfqq</span><span class="p">(</span><span class="n">bfqq</span><span class="o">-&gt;</span><span class="n">bfqd</span><span class="p">,</span> <span class="n">bfqq</span><span class="p">,</span> <span class="s">&quot;bfqq_served %lu secs&quot;</span><span class="p">,</span> <span class="n">served</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID601" rel="#L601">601</td>
          <td nowrap class="line-data " id="LC601"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID602" rel="#L602">602</td>
          <td nowrap class="line-data " id="LC602"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID603" rel="#L603">603</td>
          <td nowrap class="line-data " id="LC603"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID604" rel="#L604">604</td>
          <td nowrap class="line-data " id="LC604"><span class="cm"> * bfq_bfqq_charge_full_budget - set the service to the entity budget.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID605" rel="#L605">605</td>
          <td nowrap class="line-data " id="LC605"><span class="cm"> * @bfqq: the queue that needs a service update.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID606" rel="#L606">606</td>
          <td nowrap class="line-data " id="LC606"><span class="cm"> *</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID607" rel="#L607">607</td>
          <td nowrap class="line-data " id="LC607"><span class="cm"> * When it&#39;s not possible to be fair in the service domain, because</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID608" rel="#L608">608</td>
          <td nowrap class="line-data " id="LC608"><span class="cm"> * a queue is not consuming its budget fast enough (the meaning of</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID609" rel="#L609">609</td>
          <td nowrap class="line-data " id="LC609"><span class="cm"> * fast depends on the timeout parameter), we charge it a full</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID610" rel="#L610">610</td>
          <td nowrap class="line-data " id="LC610"><span class="cm"> * budget.  In this way we should obtain a sort of time-domain</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID611" rel="#L611">611</td>
          <td nowrap class="line-data " id="LC611"><span class="cm"> * fairness among all the seeky/slow queues.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID612" rel="#L612">612</td>
          <td nowrap class="line-data " id="LC612"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID613" rel="#L613">613</td>
          <td nowrap class="line-data " id="LC613"><span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">bfq_bfqq_charge_full_budget</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_queue</span> <span class="o">*</span><span class="n">bfqq</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID614" rel="#L614">614</td>
          <td nowrap class="line-data " id="LC614"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID615" rel="#L615">615</td>
          <td nowrap class="line-data " id="LC615">	<span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bfqq</span><span class="o">-&gt;</span><span class="n">entity</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID616" rel="#L616">616</td>
          <td nowrap class="line-data " id="LC616"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID617" rel="#L617">617</td>
          <td nowrap class="line-data " id="LC617">	<span class="n">bfq_log_bfqq</span><span class="p">(</span><span class="n">bfqq</span><span class="o">-&gt;</span><span class="n">bfqd</span><span class="p">,</span> <span class="n">bfqq</span><span class="p">,</span> <span class="s">&quot;charge_full_budget&quot;</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID618" rel="#L618">618</td>
          <td nowrap class="line-data " id="LC618"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID619" rel="#L619">619</td>
          <td nowrap class="line-data " id="LC619">	<span class="n">bfq_bfqq_served</span><span class="p">(</span><span class="n">bfqq</span><span class="p">,</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">budget</span> <span class="o">-</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">service</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID620" rel="#L620">620</td>
          <td nowrap class="line-data " id="LC620"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID621" rel="#L621">621</td>
          <td nowrap class="line-data " id="LC621"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID622" rel="#L622">622</td>
          <td nowrap class="line-data " id="LC622"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID623" rel="#L623">623</td>
          <td nowrap class="line-data " id="LC623"><span class="cm"> * __bfq_activate_entity - activate an entity.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID624" rel="#L624">624</td>
          <td nowrap class="line-data " id="LC624"><span class="cm"> * @entity: the entity being activated.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID625" rel="#L625">625</td>
          <td nowrap class="line-data " id="LC625"><span class="cm"> *</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID626" rel="#L626">626</td>
          <td nowrap class="line-data " id="LC626"><span class="cm"> * Called whenever an entity is activated, i.e., it is not active and one</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID627" rel="#L627">627</td>
          <td nowrap class="line-data " id="LC627"><span class="cm"> * of its children receives a new request, or has to be reactivated due to</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID628" rel="#L628">628</td>
          <td nowrap class="line-data " id="LC628"><span class="cm"> * budget exhaustion.  It uses the current budget of the entity (and the</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID629" rel="#L629">629</td>
          <td nowrap class="line-data " id="LC629"><span class="cm"> * service received if @entity is active) of the queue to calculate its</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID630" rel="#L630">630</td>
          <td nowrap class="line-data " id="LC630"><span class="cm"> * timestamps.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID631" rel="#L631">631</td>
          <td nowrap class="line-data " id="LC631"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID632" rel="#L632">632</td>
          <td nowrap class="line-data " id="LC632"><span class="k">static</span> <span class="kt">void</span> <span class="nf">__bfq_activate_entity</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID633" rel="#L633">633</td>
          <td nowrap class="line-data " id="LC633"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID634" rel="#L634">634</td>
          <td nowrap class="line-data " id="LC634">	<span class="k">struct</span> <span class="n">bfq_sched_data</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">sched_data</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID635" rel="#L635">635</td>
          <td nowrap class="line-data " id="LC635">	<span class="k">struct</span> <span class="n">bfq_service_tree</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">bfq_entity_service_tree</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID636" rel="#L636">636</td>
          <td nowrap class="line-data " id="LC636"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID637" rel="#L637">637</td>
          <td nowrap class="line-data " id="LC637">	<span class="k">if</span> <span class="p">(</span><span class="n">entity</span> <span class="o">==</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">active_entity</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID638" rel="#L638">638</td>
          <td nowrap class="line-data " id="LC638">		<span class="n">BUG_ON</span><span class="p">(</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">tree</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID639" rel="#L639">639</td>
          <td nowrap class="line-data " id="LC639">		<span class="cm">/*</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID640" rel="#L640">640</td>
          <td nowrap class="line-data " id="LC640"><span class="cm">		 * If we are requeueing the current entity we have</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID641" rel="#L641">641</td>
          <td nowrap class="line-data " id="LC641"><span class="cm">		 * to take care of not charging to it service it has</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID642" rel="#L642">642</td>
          <td nowrap class="line-data " id="LC642"><span class="cm">		 * not received.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID643" rel="#L643">643</td>
          <td nowrap class="line-data " id="LC643"><span class="cm">		 */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID644" rel="#L644">644</td>
          <td nowrap class="line-data " id="LC644">		<span class="n">bfq_calc_finish</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">service</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID645" rel="#L645">645</td>
          <td nowrap class="line-data " id="LC645">		<span class="n">entity</span><span class="o">-&gt;</span><span class="n">start</span> <span class="o">=</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">finish</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID646" rel="#L646">646</td>
          <td nowrap class="line-data " id="LC646">		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">active_entity</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID647" rel="#L647">647</td>
          <td nowrap class="line-data " id="LC647">	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">tree</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">active</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID648" rel="#L648">648</td>
          <td nowrap class="line-data " id="LC648">		<span class="cm">/*</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID649" rel="#L649">649</td>
          <td nowrap class="line-data " id="LC649"><span class="cm">		 * Requeueing an entity due to a change of some</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID650" rel="#L650">650</td>
          <td nowrap class="line-data " id="LC650"><span class="cm">		 * next_active entity below it.  We reuse the old</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID651" rel="#L651">651</td>
          <td nowrap class="line-data " id="LC651"><span class="cm">		 * start time.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID652" rel="#L652">652</td>
          <td nowrap class="line-data " id="LC652"><span class="cm">		 */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID653" rel="#L653">653</td>
          <td nowrap class="line-data " id="LC653">		<span class="n">bfq_active_extract</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID654" rel="#L654">654</td>
          <td nowrap class="line-data " id="LC654">	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">tree</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">idle</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID655" rel="#L655">655</td>
          <td nowrap class="line-data " id="LC655">		<span class="cm">/*</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID656" rel="#L656">656</td>
          <td nowrap class="line-data " id="LC656"><span class="cm">		 * Must be on the idle tree, bfq_idle_extract() will</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID657" rel="#L657">657</td>
          <td nowrap class="line-data " id="LC657"><span class="cm">		 * check for that.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID658" rel="#L658">658</td>
          <td nowrap class="line-data " id="LC658"><span class="cm">		 */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID659" rel="#L659">659</td>
          <td nowrap class="line-data " id="LC659">		<span class="n">bfq_idle_extract</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID660" rel="#L660">660</td>
          <td nowrap class="line-data " id="LC660">		<span class="n">entity</span><span class="o">-&gt;</span><span class="n">start</span> <span class="o">=</span> <span class="n">bfq_gt</span><span class="p">(</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">vtime</span><span class="p">,</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">finish</span><span class="p">)</span> <span class="o">?</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID661" rel="#L661">661</td>
          <td nowrap class="line-data " id="LC661">				       <span class="n">st</span><span class="o">-&gt;</span><span class="n">vtime</span> <span class="o">:</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">finish</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID662" rel="#L662">662</td>
          <td nowrap class="line-data " id="LC662">	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID663" rel="#L663">663</td>
          <td nowrap class="line-data " id="LC663">		<span class="cm">/*</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID664" rel="#L664">664</td>
          <td nowrap class="line-data " id="LC664"><span class="cm">		 * The finish time of the entity may be invalid, and</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID665" rel="#L665">665</td>
          <td nowrap class="line-data " id="LC665"><span class="cm">		 * it is in the past for sure, otherwise the queue</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID666" rel="#L666">666</td>
          <td nowrap class="line-data " id="LC666"><span class="cm">		 * would have been on the idle tree.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID667" rel="#L667">667</td>
          <td nowrap class="line-data " id="LC667"><span class="cm">		 */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID668" rel="#L668">668</td>
          <td nowrap class="line-data " id="LC668">		<span class="n">entity</span><span class="o">-&gt;</span><span class="n">start</span> <span class="o">=</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">vtime</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID669" rel="#L669">669</td>
          <td nowrap class="line-data " id="LC669">		<span class="n">st</span><span class="o">-&gt;</span><span class="n">wsum</span> <span class="o">+=</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">weight</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID670" rel="#L670">670</td>
          <td nowrap class="line-data " id="LC670">		<span class="n">bfq_get_entity</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID671" rel="#L671">671</td>
          <td nowrap class="line-data " id="LC671"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID672" rel="#L672">672</td>
          <td nowrap class="line-data " id="LC672">		<span class="n">BUG_ON</span><span class="p">(</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">on_st</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID673" rel="#L673">673</td>
          <td nowrap class="line-data " id="LC673">		<span class="n">entity</span><span class="o">-&gt;</span><span class="n">on_st</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID674" rel="#L674">674</td>
          <td nowrap class="line-data " id="LC674">	<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID675" rel="#L675">675</td>
          <td nowrap class="line-data " id="LC675"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID676" rel="#L676">676</td>
          <td nowrap class="line-data " id="LC676">	<span class="n">st</span> <span class="o">=</span> <span class="n">__bfq_entity_update_weight_prio</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID677" rel="#L677">677</td>
          <td nowrap class="line-data " id="LC677">	<span class="n">bfq_calc_finish</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">budget</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID678" rel="#L678">678</td>
          <td nowrap class="line-data " id="LC678">	<span class="n">bfq_active_insert</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID679" rel="#L679">679</td>
          <td nowrap class="line-data " id="LC679"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID680" rel="#L680">680</td>
          <td nowrap class="line-data " id="LC680"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID681" rel="#L681">681</td>
          <td nowrap class="line-data " id="LC681"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID682" rel="#L682">682</td>
          <td nowrap class="line-data " id="LC682"><span class="cm"> * bfq_activate_entity - activate an entity and its ancestors if necessary.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID683" rel="#L683">683</td>
          <td nowrap class="line-data " id="LC683"><span class="cm"> * @entity: the entity to activate.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID684" rel="#L684">684</td>
          <td nowrap class="line-data " id="LC684"><span class="cm"> *</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID685" rel="#L685">685</td>
          <td nowrap class="line-data " id="LC685"><span class="cm"> * Activate @entity and all the entities on the path from it to the root.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID686" rel="#L686">686</td>
          <td nowrap class="line-data " id="LC686"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID687" rel="#L687">687</td>
          <td nowrap class="line-data " id="LC687"><span class="k">static</span> <span class="kt">void</span> <span class="nf">bfq_activate_entity</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID688" rel="#L688">688</td>
          <td nowrap class="line-data " id="LC688"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID689" rel="#L689">689</td>
          <td nowrap class="line-data " id="LC689">	<span class="k">struct</span> <span class="n">bfq_sched_data</span> <span class="o">*</span><span class="n">sd</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID690" rel="#L690">690</td>
          <td nowrap class="line-data " id="LC690"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID691" rel="#L691">691</td>
          <td nowrap class="line-data " id="LC691">	<span class="n">for_each_entity</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID692" rel="#L692">692</td>
          <td nowrap class="line-data " id="LC692">		<span class="n">__bfq_activate_entity</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID693" rel="#L693">693</td>
          <td nowrap class="line-data " id="LC693"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID694" rel="#L694">694</td>
          <td nowrap class="line-data " id="LC694">		<span class="n">sd</span> <span class="o">=</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">sched_data</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID695" rel="#L695">695</td>
          <td nowrap class="line-data " id="LC695">		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">bfq_update_next_active</span><span class="p">(</span><span class="n">sd</span><span class="p">))</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID696" rel="#L696">696</td>
          <td nowrap class="line-data " id="LC696">			<span class="cm">/*</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID697" rel="#L697">697</td>
          <td nowrap class="line-data " id="LC697"><span class="cm">			 * No need to propagate the activation to the</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID698" rel="#L698">698</td>
          <td nowrap class="line-data " id="LC698"><span class="cm">			 * upper entities, as they will be updated when</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID699" rel="#L699">699</td>
          <td nowrap class="line-data " id="LC699"><span class="cm">			 * the active entity is rescheduled.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID700" rel="#L700">700</td>
          <td nowrap class="line-data " id="LC700"><span class="cm">			 */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID701" rel="#L701">701</td>
          <td nowrap class="line-data " id="LC701">			<span class="k">break</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID702" rel="#L702">702</td>
          <td nowrap class="line-data " id="LC702">	<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID703" rel="#L703">703</td>
          <td nowrap class="line-data " id="LC703"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID704" rel="#L704">704</td>
          <td nowrap class="line-data " id="LC704"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID705" rel="#L705">705</td>
          <td nowrap class="line-data " id="LC705"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID706" rel="#L706">706</td>
          <td nowrap class="line-data " id="LC706"><span class="cm"> * __bfq_deactivate_entity - deactivate an entity from its service tree.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID707" rel="#L707">707</td>
          <td nowrap class="line-data " id="LC707"><span class="cm"> * @entity: the entity to deactivate.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID708" rel="#L708">708</td>
          <td nowrap class="line-data " id="LC708"><span class="cm"> * @requeue: if false, the entity will not be put into the idle tree.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID709" rel="#L709">709</td>
          <td nowrap class="line-data " id="LC709"><span class="cm"> *</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID710" rel="#L710">710</td>
          <td nowrap class="line-data " id="LC710"><span class="cm"> * Deactivate an entity, independently from its previous state.  If the</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID711" rel="#L711">711</td>
          <td nowrap class="line-data " id="LC711"><span class="cm"> * entity was not on a service tree just return, otherwise if it is on</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID712" rel="#L712">712</td>
          <td nowrap class="line-data " id="LC712"><span class="cm"> * any scheduler tree, extract it from that tree, and if necessary</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID713" rel="#L713">713</td>
          <td nowrap class="line-data " id="LC713"><span class="cm"> * and if the caller did not specify @requeue, put it on the idle tree.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID714" rel="#L714">714</td>
          <td nowrap class="line-data " id="LC714"><span class="cm"> *</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID715" rel="#L715">715</td>
          <td nowrap class="line-data " id="LC715"><span class="cm"> * Return %1 if the caller should update the entity hierarchy, i.e.,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID716" rel="#L716">716</td>
          <td nowrap class="line-data " id="LC716"><span class="cm"> * if the entity was under service or if it was the next_active for</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID717" rel="#L717">717</td>
          <td nowrap class="line-data " id="LC717"><span class="cm"> * its sched_data; return %0 otherwise.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID718" rel="#L718">718</td>
          <td nowrap class="line-data " id="LC718"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID719" rel="#L719">719</td>
          <td nowrap class="line-data " id="LC719"><span class="k">static</span> <span class="kt">int</span> <span class="nf">__bfq_deactivate_entity</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span><span class="p">,</span> <span class="kt">int</span> <span class="n">requeue</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID720" rel="#L720">720</td>
          <td nowrap class="line-data " id="LC720"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID721" rel="#L721">721</td>
          <td nowrap class="line-data " id="LC721">	<span class="k">struct</span> <span class="n">bfq_sched_data</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">sched_data</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID722" rel="#L722">722</td>
          <td nowrap class="line-data " id="LC722">	<span class="k">struct</span> <span class="n">bfq_service_tree</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">bfq_entity_service_tree</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID723" rel="#L723">723</td>
          <td nowrap class="line-data " id="LC723">	<span class="kt">int</span> <span class="n">was_active</span> <span class="o">=</span> <span class="n">entity</span> <span class="o">==</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">active_entity</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID724" rel="#L724">724</td>
          <td nowrap class="line-data " id="LC724">	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID725" rel="#L725">725</td>
          <td nowrap class="line-data " id="LC725"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID726" rel="#L726">726</td>
          <td nowrap class="line-data " id="LC726">	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">on_st</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID727" rel="#L727">727</td>
          <td nowrap class="line-data " id="LC727">		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID728" rel="#L728">728</td>
          <td nowrap class="line-data " id="LC728"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID729" rel="#L729">729</td>
          <td nowrap class="line-data " id="LC729">	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">was_active</span> <span class="o">&amp;&amp;</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">tree</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID730" rel="#L730">730</td>
          <td nowrap class="line-data " id="LC730"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID731" rel="#L731">731</td>
          <td nowrap class="line-data " id="LC731">	<span class="k">if</span> <span class="p">(</span><span class="n">was_active</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID732" rel="#L732">732</td>
          <td nowrap class="line-data " id="LC732">		<span class="n">bfq_calc_finish</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">service</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID733" rel="#L733">733</td>
          <td nowrap class="line-data " id="LC733">		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">active_entity</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID734" rel="#L734">734</td>
          <td nowrap class="line-data " id="LC734">	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">tree</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">active</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID735" rel="#L735">735</td>
          <td nowrap class="line-data " id="LC735">		<span class="n">bfq_active_extract</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID736" rel="#L736">736</td>
          <td nowrap class="line-data " id="LC736">	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">tree</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">idle</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID737" rel="#L737">737</td>
          <td nowrap class="line-data " id="LC737">		<span class="n">bfq_idle_extract</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID738" rel="#L738">738</td>
          <td nowrap class="line-data " id="LC738">	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">tree</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID739" rel="#L739">739</td>
          <td nowrap class="line-data " id="LC739">		<span class="n">BUG</span><span class="p">();</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID740" rel="#L740">740</td>
          <td nowrap class="line-data " id="LC740"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID741" rel="#L741">741</td>
          <td nowrap class="line-data " id="LC741">	<span class="k">if</span> <span class="p">(</span><span class="n">was_active</span> <span class="o">||</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">next_active</span> <span class="o">==</span> <span class="n">entity</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID742" rel="#L742">742</td>
          <td nowrap class="line-data " id="LC742">		<span class="n">ret</span> <span class="o">=</span> <span class="n">bfq_update_next_active</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID743" rel="#L743">743</td>
          <td nowrap class="line-data " id="LC743"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID744" rel="#L744">744</td>
          <td nowrap class="line-data " id="LC744">	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">requeue</span> <span class="o">||</span> <span class="o">!</span><span class="n">bfq_gt</span><span class="p">(</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">finish</span><span class="p">,</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">vtime</span><span class="p">))</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID745" rel="#L745">745</td>
          <td nowrap class="line-data " id="LC745">		<span class="n">bfq_forget_entity</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID746" rel="#L746">746</td>
          <td nowrap class="line-data " id="LC746">	<span class="k">else</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID747" rel="#L747">747</td>
          <td nowrap class="line-data " id="LC747">		<span class="n">bfq_idle_insert</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID748" rel="#L748">748</td>
          <td nowrap class="line-data " id="LC748"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID749" rel="#L749">749</td>
          <td nowrap class="line-data " id="LC749">	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">active_entity</span> <span class="o">==</span> <span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID750" rel="#L750">750</td>
          <td nowrap class="line-data " id="LC750">	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">next_active</span> <span class="o">==</span> <span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID751" rel="#L751">751</td>
          <td nowrap class="line-data " id="LC751"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID752" rel="#L752">752</td>
          <td nowrap class="line-data " id="LC752">	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID753" rel="#L753">753</td>
          <td nowrap class="line-data " id="LC753"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID754" rel="#L754">754</td>
          <td nowrap class="line-data " id="LC754"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID755" rel="#L755">755</td>
          <td nowrap class="line-data " id="LC755"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID756" rel="#L756">756</td>
          <td nowrap class="line-data " id="LC756"><span class="cm"> * bfq_deactivate_entity - deactivate an entity.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID757" rel="#L757">757</td>
          <td nowrap class="line-data " id="LC757"><span class="cm"> * @entity: the entity to deactivate.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID758" rel="#L758">758</td>
          <td nowrap class="line-data " id="LC758"><span class="cm"> * @requeue: true if the entity can be put on the idle tree</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID759" rel="#L759">759</td>
          <td nowrap class="line-data " id="LC759"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID760" rel="#L760">760</td>
          <td nowrap class="line-data " id="LC760"><span class="k">static</span> <span class="kt">void</span> <span class="nf">bfq_deactivate_entity</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span><span class="p">,</span> <span class="kt">int</span> <span class="n">requeue</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID761" rel="#L761">761</td>
          <td nowrap class="line-data " id="LC761"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID762" rel="#L762">762</td>
          <td nowrap class="line-data " id="LC762">	<span class="k">struct</span> <span class="n">bfq_sched_data</span> <span class="o">*</span><span class="n">sd</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID763" rel="#L763">763</td>
          <td nowrap class="line-data " id="LC763">	<span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">parent</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID764" rel="#L764">764</td>
          <td nowrap class="line-data " id="LC764"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID765" rel="#L765">765</td>
          <td nowrap class="line-data " id="LC765">	<span class="n">for_each_entity_safe</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID766" rel="#L766">766</td>
          <td nowrap class="line-data " id="LC766">		<span class="n">sd</span> <span class="o">=</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">sched_data</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID767" rel="#L767">767</td>
          <td nowrap class="line-data " id="LC767"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID768" rel="#L768">768</td>
          <td nowrap class="line-data " id="LC768">		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">__bfq_deactivate_entity</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">requeue</span><span class="p">))</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID769" rel="#L769">769</td>
          <td nowrap class="line-data " id="LC769">			<span class="cm">/*</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID770" rel="#L770">770</td>
          <td nowrap class="line-data " id="LC770"><span class="cm">			 * The parent entity is still backlogged, and</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID771" rel="#L771">771</td>
          <td nowrap class="line-data " id="LC771"><span class="cm">			 * we don&#39;t need to update it as it is still</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID772" rel="#L772">772</td>
          <td nowrap class="line-data " id="LC772"><span class="cm">			 * under service.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID773" rel="#L773">773</td>
          <td nowrap class="line-data " id="LC773"><span class="cm">			 */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID774" rel="#L774">774</td>
          <td nowrap class="line-data " id="LC774">			<span class="k">break</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID775" rel="#L775">775</td>
          <td nowrap class="line-data " id="LC775"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID776" rel="#L776">776</td>
          <td nowrap class="line-data " id="LC776">		<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">next_active</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID777" rel="#L777">777</td>
          <td nowrap class="line-data " id="LC777">			<span class="cm">/*</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID778" rel="#L778">778</td>
          <td nowrap class="line-data " id="LC778"><span class="cm">			 * The parent entity is still backlogged and</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID779" rel="#L779">779</td>
          <td nowrap class="line-data " id="LC779"><span class="cm">			 * the budgets on the path towards the root</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID780" rel="#L780">780</td>
          <td nowrap class="line-data " id="LC780"><span class="cm">			 * need to be updated.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID781" rel="#L781">781</td>
          <td nowrap class="line-data " id="LC781"><span class="cm">			 */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID782" rel="#L782">782</td>
          <td nowrap class="line-data " id="LC782">			<span class="k">goto</span> <span class="n">update</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID783" rel="#L783">783</td>
          <td nowrap class="line-data " id="LC783"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID784" rel="#L784">784</td>
          <td nowrap class="line-data " id="LC784">		<span class="cm">/*</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID785" rel="#L785">785</td>
          <td nowrap class="line-data " id="LC785"><span class="cm">		 * If we reach there the parent is no more backlogged and</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID786" rel="#L786">786</td>
          <td nowrap class="line-data " id="LC786"><span class="cm">		 * we want to propagate the dequeue upwards.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID787" rel="#L787">787</td>
          <td nowrap class="line-data " id="LC787"><span class="cm">		 */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID788" rel="#L788">788</td>
          <td nowrap class="line-data " id="LC788">		<span class="n">requeue</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID789" rel="#L789">789</td>
          <td nowrap class="line-data " id="LC789">	<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID790" rel="#L790">790</td>
          <td nowrap class="line-data " id="LC790"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID791" rel="#L791">791</td>
          <td nowrap class="line-data " id="LC791">	<span class="k">return</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID792" rel="#L792">792</td>
          <td nowrap class="line-data " id="LC792"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID793" rel="#L793">793</td>
          <td nowrap class="line-data " id="LC793"><span class="nl">update:</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID794" rel="#L794">794</td>
          <td nowrap class="line-data " id="LC794">	<span class="n">entity</span> <span class="o">=</span> <span class="n">parent</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID795" rel="#L795">795</td>
          <td nowrap class="line-data " id="LC795">	<span class="n">for_each_entity</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID796" rel="#L796">796</td>
          <td nowrap class="line-data " id="LC796">		<span class="n">__bfq_activate_entity</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID797" rel="#L797">797</td>
          <td nowrap class="line-data " id="LC797"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID798" rel="#L798">798</td>
          <td nowrap class="line-data " id="LC798">		<span class="n">sd</span> <span class="o">=</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">sched_data</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID799" rel="#L799">799</td>
          <td nowrap class="line-data " id="LC799">		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">bfq_update_next_active</span><span class="p">(</span><span class="n">sd</span><span class="p">))</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID800" rel="#L800">800</td>
          <td nowrap class="line-data " id="LC800">			<span class="k">break</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID801" rel="#L801">801</td>
          <td nowrap class="line-data " id="LC801">	<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID802" rel="#L802">802</td>
          <td nowrap class="line-data " id="LC802"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID803" rel="#L803">803</td>
          <td nowrap class="line-data " id="LC803"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID804" rel="#L804">804</td>
          <td nowrap class="line-data " id="LC804"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID805" rel="#L805">805</td>
          <td nowrap class="line-data " id="LC805"><span class="cm"> * bfq_update_vtime - update vtime if necessary.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID806" rel="#L806">806</td>
          <td nowrap class="line-data " id="LC806"><span class="cm"> * @st: the service tree to act upon.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID807" rel="#L807">807</td>
          <td nowrap class="line-data " id="LC807"><span class="cm"> *</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID808" rel="#L808">808</td>
          <td nowrap class="line-data " id="LC808"><span class="cm"> * If necessary update the service tree vtime to have at least one</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID809" rel="#L809">809</td>
          <td nowrap class="line-data " id="LC809"><span class="cm"> * eligible entity, skipping to its start time.  Assumes that the</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID810" rel="#L810">810</td>
          <td nowrap class="line-data " id="LC810"><span class="cm"> * active tree of the device is not empty.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID811" rel="#L811">811</td>
          <td nowrap class="line-data " id="LC811"><span class="cm"> *</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID812" rel="#L812">812</td>
          <td nowrap class="line-data " id="LC812"><span class="cm"> * NOTE: this hierarchical implementation updates vtimes quite often,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID813" rel="#L813">813</td>
          <td nowrap class="line-data " id="LC813"><span class="cm"> * we may end up with reactivated tasks getting timestamps after a</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID814" rel="#L814">814</td>
          <td nowrap class="line-data " id="LC814"><span class="cm"> * vtime skip done because we needed a -&gt;first_active entity on some</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID815" rel="#L815">815</td>
          <td nowrap class="line-data " id="LC815"><span class="cm"> * intermediate node.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID816" rel="#L816">816</td>
          <td nowrap class="line-data " id="LC816"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID817" rel="#L817">817</td>
          <td nowrap class="line-data " id="LC817"><span class="k">static</span> <span class="kt">void</span> <span class="nf">bfq_update_vtime</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_service_tree</span> <span class="o">*</span><span class="n">st</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID818" rel="#L818">818</td>
          <td nowrap class="line-data " id="LC818"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID819" rel="#L819">819</td>
          <td nowrap class="line-data " id="LC819">	<span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entry</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID820" rel="#L820">820</td>
          <td nowrap class="line-data " id="LC820">	<span class="k">struct</span> <span class="n">rb_node</span> <span class="o">*</span><span class="n">node</span> <span class="o">=</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">active</span><span class="p">.</span><span class="n">rb_node</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID821" rel="#L821">821</td>
          <td nowrap class="line-data " id="LC821"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID822" rel="#L822">822</td>
          <td nowrap class="line-data " id="LC822">	<span class="n">entry</span> <span class="o">=</span> <span class="n">rb_entry</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bfq_entity</span><span class="p">,</span> <span class="n">rb_node</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID823" rel="#L823">823</td>
          <td nowrap class="line-data " id="LC823">	<span class="k">if</span> <span class="p">(</span><span class="n">bfq_gt</span><span class="p">(</span><span class="n">entry</span><span class="o">-&gt;</span><span class="n">min_start</span><span class="p">,</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">vtime</span><span class="p">))</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID824" rel="#L824">824</td>
          <td nowrap class="line-data " id="LC824">		<span class="n">st</span><span class="o">-&gt;</span><span class="n">vtime</span> <span class="o">=</span> <span class="n">entry</span><span class="o">-&gt;</span><span class="n">min_start</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID825" rel="#L825">825</td>
          <td nowrap class="line-data " id="LC825">		<span class="n">bfq_forget_idle</span><span class="p">(</span><span class="n">st</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID826" rel="#L826">826</td>
          <td nowrap class="line-data " id="LC826">	<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID827" rel="#L827">827</td>
          <td nowrap class="line-data " id="LC827"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID828" rel="#L828">828</td>
          <td nowrap class="line-data " id="LC828"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID829" rel="#L829">829</td>
          <td nowrap class="line-data " id="LC829"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID830" rel="#L830">830</td>
          <td nowrap class="line-data " id="LC830"><span class="cm"> * bfq_first_active - find the eligible entity with the smallest finish time</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID831" rel="#L831">831</td>
          <td nowrap class="line-data " id="LC831"><span class="cm"> * @st: the service tree to select from.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID832" rel="#L832">832</td>
          <td nowrap class="line-data " id="LC832"><span class="cm"> *</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID833" rel="#L833">833</td>
          <td nowrap class="line-data " id="LC833"><span class="cm"> * This function searches the first schedulable entity, starting from the</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID834" rel="#L834">834</td>
          <td nowrap class="line-data " id="LC834"><span class="cm"> * root of the tree and going on the left every time on this side there is</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID835" rel="#L835">835</td>
          <td nowrap class="line-data " id="LC835"><span class="cm"> * a subtree with at least one eligible (start &gt;= vtime) entity.  The path</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID836" rel="#L836">836</td>
          <td nowrap class="line-data " id="LC836"><span class="cm"> * on the right is followed only if a) the left subtree contains no eligible</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID837" rel="#L837">837</td>
          <td nowrap class="line-data " id="LC837"><span class="cm"> * entities and b) no eligible entity has been found yet.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID838" rel="#L838">838</td>
          <td nowrap class="line-data " id="LC838"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID839" rel="#L839">839</td>
          <td nowrap class="line-data " id="LC839"><span class="k">static</span> <span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="nf">bfq_first_active_entity</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_service_tree</span> <span class="o">*</span><span class="n">st</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID840" rel="#L840">840</td>
          <td nowrap class="line-data " id="LC840"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID841" rel="#L841">841</td>
          <td nowrap class="line-data " id="LC841">	<span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entry</span><span class="p">,</span> <span class="o">*</span><span class="n">first</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID842" rel="#L842">842</td>
          <td nowrap class="line-data " id="LC842">	<span class="k">struct</span> <span class="n">rb_node</span> <span class="o">*</span><span class="n">node</span> <span class="o">=</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">active</span><span class="p">.</span><span class="n">rb_node</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID843" rel="#L843">843</td>
          <td nowrap class="line-data " id="LC843"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID844" rel="#L844">844</td>
          <td nowrap class="line-data " id="LC844">	<span class="k">while</span> <span class="p">(</span><span class="n">node</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID845" rel="#L845">845</td>
          <td nowrap class="line-data " id="LC845">		<span class="n">entry</span> <span class="o">=</span> <span class="n">rb_entry</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bfq_entity</span><span class="p">,</span> <span class="n">rb_node</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID846" rel="#L846">846</td>
          <td nowrap class="line-data " id="LC846"><span class="nl">left:</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID847" rel="#L847">847</td>
          <td nowrap class="line-data " id="LC847">		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">bfq_gt</span><span class="p">(</span><span class="n">entry</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">,</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">vtime</span><span class="p">))</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID848" rel="#L848">848</td>
          <td nowrap class="line-data " id="LC848">			<span class="n">first</span> <span class="o">=</span> <span class="n">entry</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID849" rel="#L849">849</td>
          <td nowrap class="line-data " id="LC849"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID850" rel="#L850">850</td>
          <td nowrap class="line-data " id="LC850">		<span class="n">BUG_ON</span><span class="p">(</span><span class="n">bfq_gt</span><span class="p">(</span><span class="n">entry</span><span class="o">-&gt;</span><span class="n">min_start</span><span class="p">,</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">vtime</span><span class="p">));</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID851" rel="#L851">851</td>
          <td nowrap class="line-data " id="LC851"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID852" rel="#L852">852</td>
          <td nowrap class="line-data " id="LC852">		<span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">rb_left</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID853" rel="#L853">853</td>
          <td nowrap class="line-data " id="LC853">			<span class="n">entry</span> <span class="o">=</span> <span class="n">rb_entry</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">rb_left</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID854" rel="#L854">854</td>
          <td nowrap class="line-data " id="LC854">					 <span class="k">struct</span> <span class="n">bfq_entity</span><span class="p">,</span> <span class="n">rb_node</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID855" rel="#L855">855</td>
          <td nowrap class="line-data " id="LC855">			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">bfq_gt</span><span class="p">(</span><span class="n">entry</span><span class="o">-&gt;</span><span class="n">min_start</span><span class="p">,</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">vtime</span><span class="p">))</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID856" rel="#L856">856</td>
          <td nowrap class="line-data " id="LC856">				<span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">rb_left</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID857" rel="#L857">857</td>
          <td nowrap class="line-data " id="LC857">				<span class="k">goto</span> <span class="n">left</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID858" rel="#L858">858</td>
          <td nowrap class="line-data " id="LC858">			<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID859" rel="#L859">859</td>
          <td nowrap class="line-data " id="LC859">		<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID860" rel="#L860">860</td>
          <td nowrap class="line-data " id="LC860">		<span class="k">if</span> <span class="p">(</span><span class="n">first</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID861" rel="#L861">861</td>
          <td nowrap class="line-data " id="LC861">			<span class="k">break</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID862" rel="#L862">862</td>
          <td nowrap class="line-data " id="LC862">		<span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">rb_right</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID863" rel="#L863">863</td>
          <td nowrap class="line-data " id="LC863">	<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID864" rel="#L864">864</td>
          <td nowrap class="line-data " id="LC864"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID865" rel="#L865">865</td>
          <td nowrap class="line-data " id="LC865">	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">first</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">RB_EMPTY_ROOT</span><span class="p">(</span><span class="o">&amp;</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">active</span><span class="p">));</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID866" rel="#L866">866</td>
          <td nowrap class="line-data " id="LC866">	<span class="k">return</span> <span class="n">first</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID867" rel="#L867">867</td>
          <td nowrap class="line-data " id="LC867"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID868" rel="#L868">868</td>
          <td nowrap class="line-data " id="LC868"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID869" rel="#L869">869</td>
          <td nowrap class="line-data " id="LC869"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID870" rel="#L870">870</td>
          <td nowrap class="line-data " id="LC870"><span class="cm"> * __bfq_lookup_next_entity - return the first eligible entity in @st.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID871" rel="#L871">871</td>
          <td nowrap class="line-data " id="LC871"><span class="cm"> * @st: the service tree.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID872" rel="#L872">872</td>
          <td nowrap class="line-data " id="LC872"><span class="cm"> *</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID873" rel="#L873">873</td>
          <td nowrap class="line-data " id="LC873"><span class="cm"> * Update the virtual time in @st and return the first eligible entity</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID874" rel="#L874">874</td>
          <td nowrap class="line-data " id="LC874"><span class="cm"> * it contains.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID875" rel="#L875">875</td>
          <td nowrap class="line-data " id="LC875"><span class="cm"> */</span></td>
        </tr>
            <tr class="section-first">
            <td nowrap class="commitinfo">
              <code>
                <a href="/MikeC84/android_kernel_htc_shooter/commit/e365591c6cacf807a865d078e5794d0245d603a4">e365591c</a>
                <a href="/MikeC84/android_kernel_htc_shooter/blame/e365591c6cacf807a865d078e5794d0245d603a4/block/bfq-sched.c">&#187;</a>
                <a href="/MikeC84">MikeC84</a>
              </code>
              <br />
              <span class="date">2012-08-20</span>
              <span class="message" title="Update BFQ Scheduler to v4">Update BFQ Scheduler to v4 </span>
            </td>
          <td nowrap class="line-number" id="LID876" rel="#L876">876</td>
          <td nowrap class="line-data " id="LC876"><span class="k">static</span> <span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="nf">__bfq_lookup_next_entity</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_service_tree</span> <span class="o">*</span><span class="n">st</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID877" rel="#L877">877</td>
          <td nowrap class="line-data " id="LC877">						   <span class="n">bool</span> <span class="n">force</span><span class="p">)</span></td>
        </tr>
            <tr class="section-first">
            <td nowrap class="commitinfo">
              <code>
                <a href="/MikeC84/android_kernel_htc_shooter/commit/8540bba587cf4e5fbcecf0f5184f69d627fee7cd">8540bba5</a>
                <a href="/MikeC84/android_kernel_htc_shooter/blame/8540bba587cf4e5fbcecf0f5184f69d627fee7cd/block/bfq-sched.c">&#187;</a>
                <a href="/MikeC84">MikeC84</a>
              </code>
              <br />
              <span class="date">2012-07-24</span>
              <span class="message" title="Add BFQ IO Scheduler">Add BFQ IO Scheduler </span>
            </td>
          <td nowrap class="line-number" id="LID878" rel="#L878">878</td>
          <td nowrap class="line-data " id="LC878"><span class="p">{</span></td>
        </tr>
            <tr class="section-first">
            <td nowrap class="commitinfo">
              <code>
                <a href="/MikeC84/android_kernel_htc_shooter/commit/e365591c6cacf807a865d078e5794d0245d603a4">e365591c</a>
                <a href="/MikeC84/android_kernel_htc_shooter/blame/e365591c6cacf807a865d078e5794d0245d603a4/block/bfq-sched.c">&#187;</a>
                <a href="/MikeC84">MikeC84</a>
              </code>
              <br />
              <span class="date">2012-08-20</span>
              <span class="message" title="Update BFQ Scheduler to v4">Update BFQ Scheduler to v4 </span>
            </td>
          <td nowrap class="line-number" id="LID879" rel="#L879">879</td>
          <td nowrap class="line-data " id="LC879">	<span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span><span class="p">,</span> <span class="o">*</span><span class="n">new_next_active</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span></td>
        </tr>
            <tr class="section-first">
            <td nowrap class="commitinfo">
              <code>
                <a href="/MikeC84/android_kernel_htc_shooter/commit/8540bba587cf4e5fbcecf0f5184f69d627fee7cd">8540bba5</a>
                <a href="/MikeC84/android_kernel_htc_shooter/blame/8540bba587cf4e5fbcecf0f5184f69d627fee7cd/block/bfq-sched.c">&#187;</a>
                <a href="/MikeC84">MikeC84</a>
              </code>
              <br />
              <span class="date">2012-07-24</span>
              <span class="message" title="Add BFQ IO Scheduler">Add BFQ IO Scheduler </span>
            </td>
          <td nowrap class="line-number" id="LID880" rel="#L880">880</td>
          <td nowrap class="line-data " id="LC880"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID881" rel="#L881">881</td>
          <td nowrap class="line-data " id="LC881">	<span class="k">if</span> <span class="p">(</span><span class="n">RB_EMPTY_ROOT</span><span class="p">(</span><span class="o">&amp;</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">active</span><span class="p">))</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID882" rel="#L882">882</td>
          <td nowrap class="line-data " id="LC882">		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID883" rel="#L883">883</td>
          <td nowrap class="line-data " id="LC883"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID884" rel="#L884">884</td>
          <td nowrap class="line-data " id="LC884">	<span class="n">bfq_update_vtime</span><span class="p">(</span><span class="n">st</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID885" rel="#L885">885</td>
          <td nowrap class="line-data " id="LC885">	<span class="n">entity</span> <span class="o">=</span> <span class="n">bfq_first_active_entity</span><span class="p">(</span><span class="n">st</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID886" rel="#L886">886</td>
          <td nowrap class="line-data " id="LC886">	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">bfq_gt</span><span class="p">(</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">,</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">vtime</span><span class="p">));</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID887" rel="#L887">887</td>
          <td nowrap class="line-data " id="LC887"></td>
        </tr>
            <tr class="section-first">
            <td nowrap class="commitinfo">
              <code>
                <a href="/MikeC84/android_kernel_htc_shooter/commit/e365591c6cacf807a865d078e5794d0245d603a4">e365591c</a>
                <a href="/MikeC84/android_kernel_htc_shooter/blame/e365591c6cacf807a865d078e5794d0245d603a4/block/bfq-sched.c">&#187;</a>
                <a href="/MikeC84">MikeC84</a>
              </code>
              <br />
              <span class="date">2012-08-20</span>
              <span class="message" title="Update BFQ Scheduler to v4">Update BFQ Scheduler to v4 </span>
            </td>
          <td nowrap class="line-number" id="LID888" rel="#L888">888</td>
          <td nowrap class="line-data " id="LC888">	<span class="cm">/*</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID889" rel="#L889">889</td>
          <td nowrap class="line-data " id="LC889"><span class="cm">	 * If the chosen entity does not match with the sched_data&#39;s</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID890" rel="#L890">890</td>
          <td nowrap class="line-data " id="LC890"><span class="cm">	 * next_active and we are forcedly serving the IDLE priority</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID891" rel="#L891">891</td>
          <td nowrap class="line-data " id="LC891"><span class="cm">	 * class tree, bubble up budget update.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID892" rel="#L892">892</td>
          <td nowrap class="line-data " id="LC892"><span class="cm">	 */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID893" rel="#L893">893</td>
          <td nowrap class="line-data " id="LC893">	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">force</span> <span class="o">&amp;&amp;</span> <span class="n">entity</span> <span class="o">!=</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">sched_data</span><span class="o">-&gt;</span><span class="n">next_active</span><span class="p">))</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID894" rel="#L894">894</td>
          <td nowrap class="line-data " id="LC894">		<span class="n">new_next_active</span> <span class="o">=</span> <span class="n">entity</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID895" rel="#L895">895</td>
          <td nowrap class="line-data " id="LC895">		<span class="n">for_each_entity</span><span class="p">(</span><span class="n">new_next_active</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID896" rel="#L896">896</td>
          <td nowrap class="line-data " id="LC896">			<span class="n">bfq_update_budget</span><span class="p">(</span><span class="n">new_next_active</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID897" rel="#L897">897</td>
          <td nowrap class="line-data " id="LC897">	<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID898" rel="#L898">898</td>
          <td nowrap class="line-data " id="LC898"></td>
        </tr>
            <tr class="section-first">
            <td nowrap class="commitinfo">
              <code>
                <a href="/MikeC84/android_kernel_htc_shooter/commit/8540bba587cf4e5fbcecf0f5184f69d627fee7cd">8540bba5</a>
                <a href="/MikeC84/android_kernel_htc_shooter/blame/8540bba587cf4e5fbcecf0f5184f69d627fee7cd/block/bfq-sched.c">&#187;</a>
                <a href="/MikeC84">MikeC84</a>
              </code>
              <br />
              <span class="date">2012-07-24</span>
              <span class="message" title="Add BFQ IO Scheduler">Add BFQ IO Scheduler </span>
            </td>
          <td nowrap class="line-number" id="LID899" rel="#L899">899</td>
          <td nowrap class="line-data " id="LC899">	<span class="k">return</span> <span class="n">entity</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID900" rel="#L900">900</td>
          <td nowrap class="line-data " id="LC900"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID901" rel="#L901">901</td>
          <td nowrap class="line-data " id="LC901"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID902" rel="#L902">902</td>
          <td nowrap class="line-data " id="LC902"><span class="cm">/**</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID903" rel="#L903">903</td>
          <td nowrap class="line-data " id="LC903"><span class="cm"> * bfq_lookup_next_entity - return the first eligible entity in @sd.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID904" rel="#L904">904</td>
          <td nowrap class="line-data " id="LC904"><span class="cm"> * @sd: the sched_data.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID905" rel="#L905">905</td>
          <td nowrap class="line-data " id="LC905"><span class="cm"> * @extract: if true the returned entity will be also extracted from @sd.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID906" rel="#L906">906</td>
          <td nowrap class="line-data " id="LC906"><span class="cm"> *</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID907" rel="#L907">907</td>
          <td nowrap class="line-data " id="LC907"><span class="cm"> * NOTE: since we cache the next_active entity at each level of the</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID908" rel="#L908">908</td>
          <td nowrap class="line-data " id="LC908"><span class="cm"> * hierarchy, the complexity of the lookup can be decreased with</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID909" rel="#L909">909</td>
          <td nowrap class="line-data " id="LC909"><span class="cm"> * absolutely no effort just returning the cached next_active value;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID910" rel="#L910">910</td>
          <td nowrap class="line-data " id="LC910"><span class="cm"> * we prefer to do full lookups to test the consistency of * the data</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID911" rel="#L911">911</td>
          <td nowrap class="line-data " id="LC911"><span class="cm"> * structures.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID912" rel="#L912">912</td>
          <td nowrap class="line-data " id="LC912"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID913" rel="#L913">913</td>
          <td nowrap class="line-data " id="LC913"><span class="k">static</span> <span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="nf">bfq_lookup_next_entity</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_sched_data</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID914" rel="#L914">914</td>
          <td nowrap class="line-data " id="LC914">						 <span class="kt">int</span> <span class="n">extract</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID915" rel="#L915">915</td>
          <td nowrap class="line-data " id="LC915">						 <span class="k">struct</span> <span class="n">bfq_data</span> <span class="o">*</span><span class="n">bfqd</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID916" rel="#L916">916</td>
          <td nowrap class="line-data " id="LC916"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID917" rel="#L917">917</td>
          <td nowrap class="line-data " id="LC917">	<span class="k">struct</span> <span class="n">bfq_service_tree</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">service_tree</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID918" rel="#L918">918</td>
          <td nowrap class="line-data " id="LC918">	<span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID919" rel="#L919">919</td>
          <td nowrap class="line-data " id="LC919">	<span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID920" rel="#L920">920</td>
          <td nowrap class="line-data " id="LC920"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID921" rel="#L921">921</td>
          <td nowrap class="line-data " id="LC921">	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">active_entity</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID922" rel="#L922">922</td>
          <td nowrap class="line-data " id="LC922"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID923" rel="#L923">923</td>
          <td nowrap class="line-data " id="LC923">	<span class="k">if</span> <span class="p">(</span><span class="n">bfqd</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="o">&amp;&amp;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID924" rel="#L924">924</td>
          <td nowrap class="line-data " id="LC924">	    <span class="n">jiffies</span> <span class="o">-</span> <span class="n">bfqd</span><span class="o">-&gt;</span><span class="n">bfq_class_idle_last_service</span> <span class="o">&gt;</span> <span class="n">BFQ_CL_IDLE_TIMEOUT</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr class="section-first">
            <td nowrap class="commitinfo">
              <code>
                <a href="/MikeC84/android_kernel_htc_shooter/commit/e365591c6cacf807a865d078e5794d0245d603a4">e365591c</a>
                <a href="/MikeC84/android_kernel_htc_shooter/blame/e365591c6cacf807a865d078e5794d0245d603a4/block/bfq-sched.c">&#187;</a>
                <a href="/MikeC84">MikeC84</a>
              </code>
              <br />
              <span class="date">2012-08-20</span>
              <span class="message" title="Update BFQ Scheduler to v4">Update BFQ Scheduler to v4 </span>
            </td>
          <td nowrap class="line-number" id="LID925" rel="#L925">925</td>
          <td nowrap class="line-data " id="LC925">		<span class="n">entity</span> <span class="o">=</span> <span class="n">__bfq_lookup_next_entity</span><span class="p">(</span><span class="n">st</span> <span class="o">+</span> <span class="n">BFQ_IOPRIO_CLASSES</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span></td>
        </tr>
            <tr class="section-first">
            <td nowrap class="commitinfo">
              <code>
                <a href="/MikeC84/android_kernel_htc_shooter/commit/8540bba587cf4e5fbcecf0f5184f69d627fee7cd">8540bba5</a>
                <a href="/MikeC84/android_kernel_htc_shooter/blame/8540bba587cf4e5fbcecf0f5184f69d627fee7cd/block/bfq-sched.c">&#187;</a>
                <a href="/MikeC84">MikeC84</a>
              </code>
              <br />
              <span class="date">2012-07-24</span>
              <span class="message" title="Add BFQ IO Scheduler">Add BFQ IO Scheduler </span>
            </td>
          <td nowrap class="line-number" id="LID926" rel="#L926">926</td>
          <td nowrap class="line-data " id="LC926">		<span class="k">if</span> <span class="p">(</span><span class="n">entity</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID927" rel="#L927">927</td>
          <td nowrap class="line-data " id="LC927">			<span class="n">i</span> <span class="o">=</span> <span class="n">BFQ_IOPRIO_CLASSES</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID928" rel="#L928">928</td>
          <td nowrap class="line-data " id="LC928">			<span class="n">bfqd</span><span class="o">-&gt;</span><span class="n">bfq_class_idle_last_service</span> <span class="o">=</span> <span class="n">jiffies</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID929" rel="#L929">929</td>
          <td nowrap class="line-data " id="LC929">			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">next_active</span> <span class="o">=</span> <span class="n">entity</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID930" rel="#L930">930</td>
          <td nowrap class="line-data " id="LC930">		<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID931" rel="#L931">931</td>
          <td nowrap class="line-data " id="LC931">	<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID932" rel="#L932">932</td>
          <td nowrap class="line-data " id="LC932">	<span class="k">for</span> <span class="p">(;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">BFQ_IOPRIO_CLASSES</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr class="section-first">
            <td nowrap class="commitinfo">
              <code>
                <a href="/MikeC84/android_kernel_htc_shooter/commit/e365591c6cacf807a865d078e5794d0245d603a4">e365591c</a>
                <a href="/MikeC84/android_kernel_htc_shooter/blame/e365591c6cacf807a865d078e5794d0245d603a4/block/bfq-sched.c">&#187;</a>
                <a href="/MikeC84">MikeC84</a>
              </code>
              <br />
              <span class="date">2012-08-20</span>
              <span class="message" title="Update BFQ Scheduler to v4">Update BFQ Scheduler to v4 </span>
            </td>
          <td nowrap class="line-number" id="LID933" rel="#L933">933</td>
          <td nowrap class="line-data " id="LC933">		<span class="n">entity</span> <span class="o">=</span> <span class="n">__bfq_lookup_next_entity</span><span class="p">(</span><span class="n">st</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span></td>
        </tr>
            <tr class="section-first">
            <td nowrap class="commitinfo">
              <code>
                <a href="/MikeC84/android_kernel_htc_shooter/commit/8540bba587cf4e5fbcecf0f5184f69d627fee7cd">8540bba5</a>
                <a href="/MikeC84/android_kernel_htc_shooter/blame/8540bba587cf4e5fbcecf0f5184f69d627fee7cd/block/bfq-sched.c">&#187;</a>
                <a href="/MikeC84">MikeC84</a>
              </code>
              <br />
              <span class="date">2012-07-24</span>
              <span class="message" title="Add BFQ IO Scheduler">Add BFQ IO Scheduler </span>
            </td>
          <td nowrap class="line-number" id="LID934" rel="#L934">934</td>
          <td nowrap class="line-data " id="LC934">		<span class="k">if</span> <span class="p">(</span><span class="n">entity</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID935" rel="#L935">935</td>
          <td nowrap class="line-data " id="LC935">			<span class="k">if</span> <span class="p">(</span><span class="n">extract</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID936" rel="#L936">936</td>
          <td nowrap class="line-data " id="LC936">				<span class="n">bfq_check_next_active</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID937" rel="#L937">937</td>
          <td nowrap class="line-data " id="LC937">				<span class="n">bfq_active_extract</span><span class="p">(</span><span class="n">st</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID938" rel="#L938">938</td>
          <td nowrap class="line-data " id="LC938">				<span class="n">sd</span><span class="o">-&gt;</span><span class="n">active_entity</span> <span class="o">=</span> <span class="n">entity</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID939" rel="#L939">939</td>
          <td nowrap class="line-data " id="LC939">				<span class="n">sd</span><span class="o">-&gt;</span><span class="n">next_active</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID940" rel="#L940">940</td>
          <td nowrap class="line-data " id="LC940">			<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID941" rel="#L941">941</td>
          <td nowrap class="line-data " id="LC941">			<span class="k">break</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID942" rel="#L942">942</td>
          <td nowrap class="line-data " id="LC942">		<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID943" rel="#L943">943</td>
          <td nowrap class="line-data " id="LC943">	<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID944" rel="#L944">944</td>
          <td nowrap class="line-data " id="LC944"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID945" rel="#L945">945</td>
          <td nowrap class="line-data " id="LC945">	<span class="k">return</span> <span class="n">entity</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID946" rel="#L946">946</td>
          <td nowrap class="line-data " id="LC946"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID947" rel="#L947">947</td>
          <td nowrap class="line-data " id="LC947"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID948" rel="#L948">948</td>
          <td nowrap class="line-data " id="LC948"><span class="cm">/*</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID949" rel="#L949">949</td>
          <td nowrap class="line-data " id="LC949"><span class="cm"> * Get next queue for service.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID950" rel="#L950">950</td>
          <td nowrap class="line-data " id="LC950"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID951" rel="#L951">951</td>
          <td nowrap class="line-data " id="LC951"><span class="k">static</span> <span class="k">struct</span> <span class="n">bfq_queue</span> <span class="o">*</span><span class="nf">bfq_get_next_queue</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_data</span> <span class="o">*</span><span class="n">bfqd</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID952" rel="#L952">952</td>
          <td nowrap class="line-data " id="LC952"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID953" rel="#L953">953</td>
          <td nowrap class="line-data " id="LC953">	<span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID954" rel="#L954">954</td>
          <td nowrap class="line-data " id="LC954">	<span class="k">struct</span> <span class="n">bfq_sched_data</span> <span class="o">*</span><span class="n">sd</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID955" rel="#L955">955</td>
          <td nowrap class="line-data " id="LC955">	<span class="k">struct</span> <span class="n">bfq_queue</span> <span class="o">*</span><span class="n">bfqq</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID956" rel="#L956">956</td>
          <td nowrap class="line-data " id="LC956"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID957" rel="#L957">957</td>
          <td nowrap class="line-data " id="LC957">	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">bfqd</span><span class="o">-&gt;</span><span class="n">active_queue</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID958" rel="#L958">958</td>
          <td nowrap class="line-data " id="LC958"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID959" rel="#L959">959</td>
          <td nowrap class="line-data " id="LC959">	<span class="k">if</span> <span class="p">(</span><span class="n">bfqd</span><span class="o">-&gt;</span><span class="n">busy_queues</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID960" rel="#L960">960</td>
          <td nowrap class="line-data " id="LC960">		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID961" rel="#L961">961</td>
          <td nowrap class="line-data " id="LC961"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID962" rel="#L962">962</td>
          <td nowrap class="line-data " id="LC962">	<span class="n">sd</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bfqd</span><span class="o">-&gt;</span><span class="n">root_group</span><span class="o">-&gt;</span><span class="n">sched_data</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID963" rel="#L963">963</td>
          <td nowrap class="line-data " id="LC963">	<span class="k">for</span> <span class="p">(;</span> <span class="n">sd</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">sd</span> <span class="o">=</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">my_sched_data</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID964" rel="#L964">964</td>
          <td nowrap class="line-data " id="LC964">		<span class="n">entity</span> <span class="o">=</span> <span class="n">bfq_lookup_next_entity</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bfqd</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID965" rel="#L965">965</td>
          <td nowrap class="line-data " id="LC965">		<span class="n">BUG_ON</span><span class="p">(</span><span class="n">entity</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID966" rel="#L966">966</td>
          <td nowrap class="line-data " id="LC966">		<span class="n">entity</span><span class="o">-&gt;</span><span class="n">service</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID967" rel="#L967">967</td>
          <td nowrap class="line-data " id="LC967">	<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID968" rel="#L968">968</td>
          <td nowrap class="line-data " id="LC968"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID969" rel="#L969">969</td>
          <td nowrap class="line-data " id="LC969">	<span class="n">bfqq</span> <span class="o">=</span> <span class="n">bfq_entity_to_bfqq</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID970" rel="#L970">970</td>
          <td nowrap class="line-data " id="LC970">	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">bfqq</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID971" rel="#L971">971</td>
          <td nowrap class="line-data " id="LC971"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID972" rel="#L972">972</td>
          <td nowrap class="line-data " id="LC972">	<span class="k">return</span> <span class="n">bfqq</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID973" rel="#L973">973</td>
          <td nowrap class="line-data " id="LC973"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID974" rel="#L974">974</td>
          <td nowrap class="line-data " id="LC974"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID975" rel="#L975">975</td>
          <td nowrap class="line-data " id="LC975"><span class="cm">/*</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID976" rel="#L976">976</td>
          <td nowrap class="line-data " id="LC976"><span class="cm"> * Forced extraction of the given queue.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID977" rel="#L977">977</td>
          <td nowrap class="line-data " id="LC977"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID978" rel="#L978">978</td>
          <td nowrap class="line-data " id="LC978"><span class="k">static</span> <span class="kt">void</span> <span class="nf">bfq_get_next_queue_forced</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_data</span> <span class="o">*</span><span class="n">bfqd</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID979" rel="#L979">979</td>
          <td nowrap class="line-data " id="LC979">				      <span class="k">struct</span> <span class="n">bfq_queue</span> <span class="o">*</span><span class="n">bfqq</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID980" rel="#L980">980</td>
          <td nowrap class="line-data " id="LC980"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID981" rel="#L981">981</td>
          <td nowrap class="line-data " id="LC981">	<span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID982" rel="#L982">982</td>
          <td nowrap class="line-data " id="LC982">	<span class="k">struct</span> <span class="n">bfq_sched_data</span> <span class="o">*</span><span class="n">sd</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID983" rel="#L983">983</td>
          <td nowrap class="line-data " id="LC983"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID984" rel="#L984">984</td>
          <td nowrap class="line-data " id="LC984">	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">bfqd</span><span class="o">-&gt;</span><span class="n">active_queue</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID985" rel="#L985">985</td>
          <td nowrap class="line-data " id="LC985"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID986" rel="#L986">986</td>
          <td nowrap class="line-data " id="LC986">	<span class="n">entity</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bfqq</span><span class="o">-&gt;</span><span class="n">entity</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID987" rel="#L987">987</td>
          <td nowrap class="line-data " id="LC987">	<span class="cm">/*</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID988" rel="#L988">988</td>
          <td nowrap class="line-data " id="LC988"><span class="cm">	 * Bubble up extraction/update from the leaf to the root.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID989" rel="#L989">989</td>
          <td nowrap class="line-data " id="LC989"><span class="cm">	*/</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID990" rel="#L990">990</td>
          <td nowrap class="line-data " id="LC990">	<span class="n">for_each_entity</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID991" rel="#L991">991</td>
          <td nowrap class="line-data " id="LC991">		<span class="n">sd</span> <span class="o">=</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">sched_data</span><span class="p">;</span></td>
        </tr>
            <tr class="section-first">
            <td nowrap class="commitinfo">
              <code>
                <a href="/MikeC84/android_kernel_htc_shooter/commit/e365591c6cacf807a865d078e5794d0245d603a4">e365591c</a>
                <a href="/MikeC84/android_kernel_htc_shooter/blame/e365591c6cacf807a865d078e5794d0245d603a4/block/bfq-sched.c">&#187;</a>
                <a href="/MikeC84">MikeC84</a>
              </code>
              <br />
              <span class="date">2012-08-20</span>
              <span class="message" title="Update BFQ Scheduler to v4">Update BFQ Scheduler to v4 </span>
            </td>
          <td nowrap class="line-number" id="LID992" rel="#L992">992</td>
          <td nowrap class="line-data " id="LC992">		<span class="n">bfq_update_budget</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr class="section-first">
            <td nowrap class="commitinfo">
              <code>
                <a href="/MikeC84/android_kernel_htc_shooter/commit/8540bba587cf4e5fbcecf0f5184f69d627fee7cd">8540bba5</a>
                <a href="/MikeC84/android_kernel_htc_shooter/blame/8540bba587cf4e5fbcecf0f5184f69d627fee7cd/block/bfq-sched.c">&#187;</a>
                <a href="/MikeC84">MikeC84</a>
              </code>
              <br />
              <span class="date">2012-07-24</span>
              <span class="message" title="Add BFQ IO Scheduler">Add BFQ IO Scheduler </span>
            </td>
          <td nowrap class="line-number" id="LID993" rel="#L993">993</td>
          <td nowrap class="line-data " id="LC993">		<span class="n">bfq_update_vtime</span><span class="p">(</span><span class="n">bfq_entity_service_tree</span><span class="p">(</span><span class="n">entity</span><span class="p">));</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID994" rel="#L994">994</td>
          <td nowrap class="line-data " id="LC994">		<span class="n">bfq_active_extract</span><span class="p">(</span><span class="n">bfq_entity_service_tree</span><span class="p">(</span><span class="n">entity</span><span class="p">),</span> <span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID995" rel="#L995">995</td>
          <td nowrap class="line-data " id="LC995">		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">active_entity</span> <span class="o">=</span> <span class="n">entity</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID996" rel="#L996">996</td>
          <td nowrap class="line-data " id="LC996">		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">next_active</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID997" rel="#L997">997</td>
          <td nowrap class="line-data " id="LC997">		<span class="n">entity</span><span class="o">-&gt;</span><span class="n">service</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID998" rel="#L998">998</td>
          <td nowrap class="line-data " id="LC998">	<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID999" rel="#L999">999</td>
          <td nowrap class="line-data " id="LC999"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1000" rel="#L1000">1000</td>
          <td nowrap class="line-data " id="LC1000">	<span class="k">return</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1001" rel="#L1001">1001</td>
          <td nowrap class="line-data " id="LC1001"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1002" rel="#L1002">1002</td>
          <td nowrap class="line-data " id="LC1002"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1003" rel="#L1003">1003</td>
          <td nowrap class="line-data " id="LC1003"><span class="k">static</span> <span class="kt">void</span> <span class="nf">__bfq_bfqd_reset_active</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_data</span> <span class="o">*</span><span class="n">bfqd</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1004" rel="#L1004">1004</td>
          <td nowrap class="line-data " id="LC1004"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1005" rel="#L1005">1005</td>
          <td nowrap class="line-data " id="LC1005">	<span class="k">if</span> <span class="p">(</span><span class="n">bfqd</span><span class="o">-&gt;</span><span class="n">active_cic</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1006" rel="#L1006">1006</td>
          <td nowrap class="line-data " id="LC1006">		<span class="n">put_io_context</span><span class="p">(</span><span class="n">bfqd</span><span class="o">-&gt;</span><span class="n">active_cic</span><span class="o">-&gt;</span><span class="n">ioc</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1007" rel="#L1007">1007</td>
          <td nowrap class="line-data " id="LC1007">		<span class="n">bfqd</span><span class="o">-&gt;</span><span class="n">active_cic</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1008" rel="#L1008">1008</td>
          <td nowrap class="line-data " id="LC1008">	<span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1009" rel="#L1009">1009</td>
          <td nowrap class="line-data " id="LC1009"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1010" rel="#L1010">1010</td>
          <td nowrap class="line-data " id="LC1010">	<span class="n">bfqd</span><span class="o">-&gt;</span><span class="n">active_queue</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1011" rel="#L1011">1011</td>
          <td nowrap class="line-data " id="LC1011">	<span class="n">del_timer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bfqd</span><span class="o">-&gt;</span><span class="n">idle_slice_timer</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1012" rel="#L1012">1012</td>
          <td nowrap class="line-data " id="LC1012"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1013" rel="#L1013">1013</td>
          <td nowrap class="line-data " id="LC1013"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1014" rel="#L1014">1014</td>
          <td nowrap class="line-data " id="LC1014"><span class="k">static</span> <span class="kt">void</span> <span class="nf">bfq_deactivate_bfqq</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_data</span> <span class="o">*</span><span class="n">bfqd</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bfq_queue</span> <span class="o">*</span><span class="n">bfqq</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1015" rel="#L1015">1015</td>
          <td nowrap class="line-data " id="LC1015">				<span class="kt">int</span> <span class="n">requeue</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1016" rel="#L1016">1016</td>
          <td nowrap class="line-data " id="LC1016"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1017" rel="#L1017">1017</td>
          <td nowrap class="line-data " id="LC1017">	<span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bfqq</span><span class="o">-&gt;</span><span class="n">entity</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1018" rel="#L1018">1018</td>
          <td nowrap class="line-data " id="LC1018"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1019" rel="#L1019">1019</td>
          <td nowrap class="line-data " id="LC1019">	<span class="k">if</span> <span class="p">(</span><span class="n">bfqq</span> <span class="o">==</span> <span class="n">bfqd</span><span class="o">-&gt;</span><span class="n">active_queue</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1020" rel="#L1020">1020</td>
          <td nowrap class="line-data " id="LC1020">		<span class="n">__bfq_bfqd_reset_active</span><span class="p">(</span><span class="n">bfqd</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1021" rel="#L1021">1021</td>
          <td nowrap class="line-data " id="LC1021"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1022" rel="#L1022">1022</td>
          <td nowrap class="line-data " id="LC1022">	<span class="n">bfq_deactivate_entity</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">requeue</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1023" rel="#L1023">1023</td>
          <td nowrap class="line-data " id="LC1023"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1024" rel="#L1024">1024</td>
          <td nowrap class="line-data " id="LC1024"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1025" rel="#L1025">1025</td>
          <td nowrap class="line-data " id="LC1025"><span class="k">static</span> <span class="kt">void</span> <span class="nf">bfq_activate_bfqq</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_data</span> <span class="o">*</span><span class="n">bfqd</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bfq_queue</span> <span class="o">*</span><span class="n">bfqq</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1026" rel="#L1026">1026</td>
          <td nowrap class="line-data " id="LC1026"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1027" rel="#L1027">1027</td>
          <td nowrap class="line-data " id="LC1027">	<span class="k">struct</span> <span class="n">bfq_entity</span> <span class="o">*</span><span class="n">entity</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bfqq</span><span class="o">-&gt;</span><span class="n">entity</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1028" rel="#L1028">1028</td>
          <td nowrap class="line-data " id="LC1028"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1029" rel="#L1029">1029</td>
          <td nowrap class="line-data " id="LC1029">	<span class="n">bfq_activate_entity</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1030" rel="#L1030">1030</td>
          <td nowrap class="line-data " id="LC1030"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1031" rel="#L1031">1031</td>
          <td nowrap class="line-data " id="LC1031"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1032" rel="#L1032">1032</td>
          <td nowrap class="line-data " id="LC1032"><span class="cm">/*</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1033" rel="#L1033">1033</td>
          <td nowrap class="line-data " id="LC1033"><span class="cm"> * Called when the bfqq no longer has requests pending, remove it from</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1034" rel="#L1034">1034</td>
          <td nowrap class="line-data " id="LC1034"><span class="cm"> * the service tree.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1035" rel="#L1035">1035</td>
          <td nowrap class="line-data " id="LC1035"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1036" rel="#L1036">1036</td>
          <td nowrap class="line-data " id="LC1036"><span class="k">static</span> <span class="kt">void</span> <span class="nf">bfq_del_bfqq_busy</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_data</span> <span class="o">*</span><span class="n">bfqd</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bfq_queue</span> <span class="o">*</span><span class="n">bfqq</span><span class="p">,</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1037" rel="#L1037">1037</td>
          <td nowrap class="line-data " id="LC1037">			      <span class="kt">int</span> <span class="n">requeue</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1038" rel="#L1038">1038</td>
          <td nowrap class="line-data " id="LC1038"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1039" rel="#L1039">1039</td>
          <td nowrap class="line-data " id="LC1039">	<span class="n">BUG_ON</span><span class="p">(</span><span class="o">!</span><span class="n">bfq_bfqq_busy</span><span class="p">(</span><span class="n">bfqq</span><span class="p">));</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1040" rel="#L1040">1040</td>
          <td nowrap class="line-data " id="LC1040">	<span class="n">BUG_ON</span><span class="p">(</span><span class="o">!</span><span class="n">RB_EMPTY_ROOT</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bfqq</span><span class="o">-&gt;</span><span class="n">sort_list</span><span class="p">));</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1041" rel="#L1041">1041</td>
          <td nowrap class="line-data " id="LC1041"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1042" rel="#L1042">1042</td>
          <td nowrap class="line-data " id="LC1042">	<span class="n">bfq_log_bfqq</span><span class="p">(</span><span class="n">bfqd</span><span class="p">,</span> <span class="n">bfqq</span><span class="p">,</span> <span class="s">&quot;del from busy&quot;</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1043" rel="#L1043">1043</td>
          <td nowrap class="line-data " id="LC1043"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1044" rel="#L1044">1044</td>
          <td nowrap class="line-data " id="LC1044">	<span class="n">bfq_clear_bfqq_busy</span><span class="p">(</span><span class="n">bfqq</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1045" rel="#L1045">1045</td>
          <td nowrap class="line-data " id="LC1045"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1046" rel="#L1046">1046</td>
          <td nowrap class="line-data " id="LC1046">	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">bfqd</span><span class="o">-&gt;</span><span class="n">busy_queues</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1047" rel="#L1047">1047</td>
          <td nowrap class="line-data " id="LC1047">	<span class="n">bfqd</span><span class="o">-&gt;</span><span class="n">busy_queues</span><span class="o">--</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1048" rel="#L1048">1048</td>
          <td nowrap class="line-data " id="LC1048"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1049" rel="#L1049">1049</td>
          <td nowrap class="line-data " id="LC1049">	<span class="n">bfq_deactivate_bfqq</span><span class="p">(</span><span class="n">bfqd</span><span class="p">,</span> <span class="n">bfqq</span><span class="p">,</span> <span class="n">requeue</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1050" rel="#L1050">1050</td>
          <td nowrap class="line-data " id="LC1050"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1051" rel="#L1051">1051</td>
          <td nowrap class="line-data " id="LC1051"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1052" rel="#L1052">1052</td>
          <td nowrap class="line-data " id="LC1052"><span class="cm">/*</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1053" rel="#L1053">1053</td>
          <td nowrap class="line-data " id="LC1053"><span class="cm"> * Called when an inactive queue receives a new request.</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1054" rel="#L1054">1054</td>
          <td nowrap class="line-data " id="LC1054"><span class="cm"> */</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1055" rel="#L1055">1055</td>
          <td nowrap class="line-data " id="LC1055"><span class="k">static</span> <span class="kt">void</span> <span class="nf">bfq_add_bfqq_busy</span><span class="p">(</span><span class="k">struct</span> <span class="n">bfq_data</span> <span class="o">*</span><span class="n">bfqd</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bfq_queue</span> <span class="o">*</span><span class="n">bfqq</span><span class="p">)</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1056" rel="#L1056">1056</td>
          <td nowrap class="line-data " id="LC1056"><span class="p">{</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1057" rel="#L1057">1057</td>
          <td nowrap class="line-data " id="LC1057">	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">bfq_bfqq_busy</span><span class="p">(</span><span class="n">bfqq</span><span class="p">));</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1058" rel="#L1058">1058</td>
          <td nowrap class="line-data " id="LC1058">	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">bfqq</span> <span class="o">==</span> <span class="n">bfqd</span><span class="o">-&gt;</span><span class="n">active_queue</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1059" rel="#L1059">1059</td>
          <td nowrap class="line-data " id="LC1059"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1060" rel="#L1060">1060</td>
          <td nowrap class="line-data " id="LC1060">	<span class="n">bfq_log_bfqq</span><span class="p">(</span><span class="n">bfqd</span><span class="p">,</span> <span class="n">bfqq</span><span class="p">,</span> <span class="s">&quot;add to busy&quot;</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1061" rel="#L1061">1061</td>
          <td nowrap class="line-data " id="LC1061"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1062" rel="#L1062">1062</td>
          <td nowrap class="line-data " id="LC1062">	<span class="n">bfq_activate_bfqq</span><span class="p">(</span><span class="n">bfqd</span><span class="p">,</span> <span class="n">bfqq</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1063" rel="#L1063">1063</td>
          <td nowrap class="line-data " id="LC1063"></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1064" rel="#L1064">1064</td>
          <td nowrap class="line-data " id="LC1064">	<span class="n">bfq_mark_bfqq_busy</span><span class="p">(</span><span class="n">bfqq</span><span class="p">);</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1065" rel="#L1065">1065</td>
          <td nowrap class="line-data " id="LC1065">	<span class="n">bfqd</span><span class="o">-&gt;</span><span class="n">busy_queues</span><span class="o">++</span><span class="p">;</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1066" rel="#L1066">1066</td>
          <td nowrap class="line-data " id="LC1066"><span class="p">}</span></td>
        </tr>
            <tr>
            <td nowrap> </td>
          <td nowrap class="line-number" id="LID1067" rel="#L1067">1067</td>
          <td nowrap class="line-data " id="LC1067"></td>
        </tr>
      </table>
    </div>

  </div>
</div>

        </div>
      </div>
      <div class="context-overlay"></div>
    </div>

      <div id="footer-push"></div><!-- hack for sticky footer -->
    </div><!-- end of wrapper - hack for sticky footer -->

      <!-- footer -->
      <div id="footer" >
        
  <div class="upper_footer">
     <div class="container clearfix">

       <!--[if IE]><h4 id="blacktocat_ie">GitHub Links</h4><![endif]-->
       <![if !IE]><h4 id="blacktocat">GitHub Links</h4><![endif]>

       <ul class="footer_nav">
         <h4>GitHub</h4>
         <li><a href="https://github.com/about">About</a></li>
         <li><a href="https://github.com/blog">Blog</a></li>
         <li><a href="https://github.com/features">Features</a></li>
         <li><a href="https://github.com/contact">Contact &amp; Support</a></li>
         <li><a href="https://github.com/training">Training</a></li>
         <li><a href="http://enterprise.github.com/">GitHub Enterprise</a></li>
         <li><a href="http://status.github.com/">Site Status</a></li>
       </ul>

       <ul class="footer_nav">
         <h4>Clients</h4>
         <li><a href="http://mac.github.com/">GitHub for Mac</a></li>
         <li><a href="http://windows.github.com/">GitHub for Windows</a></li>
         <li><a href="http://eclipse.github.com/">GitHub for Eclipse</a></li>
         <li><a href="http://mobile.github.com/">GitHub Mobile Apps</a></li>
       </ul>

       <ul class="footer_nav">
         <h4>Tools</h4>
         <li><a href="http://get.gaug.es/">Gauges: Web analytics</a></li>
         <li><a href="http://speakerdeck.com">Speaker Deck: Presentations</a></li>
         <li><a href="https://gist.github.com">Gist: Code snippets</a></li>

         <h4 class="second">Extras</h4>
         <li><a href="http://jobs.github.com/">Job Board</a></li>
         <li><a href="http://shop.github.com/">GitHub Shop</a></li>
         <li><a href="http://octodex.github.com/">The Octodex</a></li>
       </ul>

       <ul class="footer_nav">
         <h4>Documentation</h4>
         <li><a href="http://help.github.com/">GitHub Help</a></li>
         <li><a href="http://developer.github.com/">Developer API</a></li>
         <li><a href="http://github.github.com/github-flavored-markdown/">GitHub Flavored Markdown</a></li>
         <li><a href="http://pages.github.com/">GitHub Pages</a></li>
       </ul>

     </div><!-- /.site -->
  </div><!-- /.upper_footer -->

<div class="lower_footer">
  <div class="container clearfix">
    <!--[if IE]><div id="legal_ie"><![endif]-->
    <![if !IE]><div id="legal"><![endif]>
      <ul>
          <li><a href="https://github.com/site/terms">Terms of Service</a></li>
          <li><a href="https://github.com/site/privacy">Privacy</a></li>
          <li><a href="https://github.com/security">Security</a></li>
      </ul>

      <p>&copy; 2012 <span title="0.45091s from fe1.rs.github.com">GitHub</span> Inc. All rights reserved.</p>
    </div><!-- /#legal or /#legal_ie-->

  </div><!-- /.site -->
</div><!-- /.lower_footer -->

      </div><!-- /#footer -->

    

<div id="keyboard_shortcuts_pane" class="instapaper_ignore readability-extra" style="display:none">
  <h2>Keyboard Shortcuts <small><a href="#" class="js-see-all-keyboard-shortcuts">(see all)</a></small></h2>

  <div class="columns threecols">
    <div class="column first">
      <h3>Site wide shortcuts</h3>
      <dl class="keyboard-mappings">
        <dt>s</dt>
        <dd>Focus site search</dd>
      </dl>
      <dl class="keyboard-mappings">
        <dt>?</dt>
        <dd>Bring up this help dialog</dd>
      </dl>
    </div><!-- /.column.first -->

    <div class="column middle" style='display:none'>
      <h3>Commit list</h3>
      <dl class="keyboard-mappings">
        <dt>j</dt>
        <dd>Move selection down</dd>
      </dl>
      <dl class="keyboard-mappings">
        <dt>k</dt>
        <dd>Move selection up</dd>
      </dl>
      <dl class="keyboard-mappings">
        <dt>c <em>or</em> o <em>or</em> enter</dt>
        <dd>Open commit</dd>
      </dl>
      <dl class="keyboard-mappings">
        <dt>y</dt>
        <dd>Expand URL to its canonical form</dd>
      </dl>
    </div><!-- /.column.first -->

    <div class="column last js-hidden-pane" style='display:none'>
      <h3>Pull request list</h3>
      <dl class="keyboard-mappings">
        <dt>j</dt>
        <dd>Move selection down</dd>
      </dl>
      <dl class="keyboard-mappings">
        <dt>k</dt>
        <dd>Move selection up</dd>
      </dl>
      <dl class="keyboard-mappings">
        <dt>o <em>or</em> enter</dt>
        <dd>Open issue</dd>
      </dl>
      <dl class="keyboard-mappings">
        <dt><span class="platform-mac">⌘</span><span class="platform-other">ctrl</span> <em>+</em> enter</dt>
        <dd>Submit comment</dd>
      </dl>
      <dl class="keyboard-mappings">
        <dt><span class="platform-mac">⌘</span><span class="platform-other">ctrl</span> <em>+</em> shift p</dt>
        <dd>Preview comment</dd>
      </dl>
    </div><!-- /.columns.last -->

  </div><!-- /.columns.equacols -->

  <div class="js-hidden-pane" style='display:none'>
    <div class="rule"></div>

    <h3>Issues</h3>

    <div class="columns threecols">
      <div class="column first">
        <dl class="keyboard-mappings">
          <dt>j</dt>
          <dd>Move selection down</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>k</dt>
          <dd>Move selection up</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>x</dt>
          <dd>Toggle selection</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>o <em>or</em> enter</dt>
          <dd>Open issue</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt><span class="platform-mac">⌘</span><span class="platform-other">ctrl</span> <em>+</em> enter</dt>
          <dd>Submit comment</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt><span class="platform-mac">⌘</span><span class="platform-other">ctrl</span> <em>+</em> shift p</dt>
          <dd>Preview comment</dd>
        </dl>
      </div><!-- /.column.first -->
      <div class="column last">
        <dl class="keyboard-mappings">
          <dt>c</dt>
          <dd>Create issue</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>l</dt>
          <dd>Create label</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>i</dt>
          <dd>Back to inbox</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>u</dt>
          <dd>Back to issues</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>/</dt>
          <dd>Focus issues search</dd>
        </dl>
      </div>
    </div>
  </div>

  <div class="js-hidden-pane" style='display:none'>
    <div class="rule"></div>

    <h3>Issues Dashboard</h3>

    <div class="columns threecols">
      <div class="column first">
        <dl class="keyboard-mappings">
          <dt>j</dt>
          <dd>Move selection down</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>k</dt>
          <dd>Move selection up</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>o <em>or</em> enter</dt>
          <dd>Open issue</dd>
        </dl>
      </div><!-- /.column.first -->
    </div>
  </div>

  <div class="js-hidden-pane" style='display:none'>
    <div class="rule"></div>

    <h3>Network Graph</h3>
    <div class="columns equacols">
      <div class="column first">
        <dl class="keyboard-mappings">
          <dt><span class="badmono">←</span> <em>or</em> h</dt>
          <dd>Scroll left</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt><span class="badmono">→</span> <em>or</em> l</dt>
          <dd>Scroll right</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt><span class="badmono">↑</span> <em>or</em> k</dt>
          <dd>Scroll up</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt><span class="badmono">↓</span> <em>or</em> j</dt>
          <dd>Scroll down</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>t</dt>
          <dd>Toggle visibility of head labels</dd>
        </dl>
      </div><!-- /.column.first -->
      <div class="column last">
        <dl class="keyboard-mappings">
          <dt>shift <span class="badmono">←</span> <em>or</em> shift h</dt>
          <dd>Scroll all the way left</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>shift <span class="badmono">→</span> <em>or</em> shift l</dt>
          <dd>Scroll all the way right</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>shift <span class="badmono">↑</span> <em>or</em> shift k</dt>
          <dd>Scroll all the way up</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>shift <span class="badmono">↓</span> <em>or</em> shift j</dt>
          <dd>Scroll all the way down</dd>
        </dl>
      </div><!-- /.column.last -->
    </div>
  </div>

  <div class="js-hidden-pane" >
    <div class="rule"></div>
    <div class="columns threecols">
      <div class="column first js-hidden-pane" >
        <h3>Source Code Browsing</h3>
        <dl class="keyboard-mappings">
          <dt>t</dt>
          <dd>Activates the file finder</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>l</dt>
          <dd>Jump to line</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>w</dt>
          <dd>Switch branch/tag</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>y</dt>
          <dd>Expand URL to its canonical form</dd>
        </dl>
      </div>
    </div>
  </div>

  <div class="js-hidden-pane" style='display:none'>
    <div class="rule"></div>
    <div class="columns threecols">
      <div class="column first">
        <h3>Browsing Commits</h3>
        <dl class="keyboard-mappings">
          <dt><span class="platform-mac">⌘</span><span class="platform-other">ctrl</span> <em>+</em> enter</dt>
          <dd>Submit comment</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>escape</dt>
          <dd>Close form</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>p</dt>
          <dd>Parent commit</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>o</dt>
          <dd>Other parent commit</dd>
        </dl>
      </div>
    </div>
  </div>

  <div class="js-hidden-pane" style='display:none'>
    <div class="rule"></div>
    <h3>Notifications</h3>

    <div class="columns threecols">
      <div class="column first">
        <dl class="keyboard-mappings">
          <dt>j</dt>
          <dd>Move selection down</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>k</dt>
          <dd>Move selection up</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>o <em>or</em> enter</dt>
          <dd>Open notification</dd>
        </dl>
      </div><!-- /.column.first -->

      <div class="column second">
        <dl class="keyboard-mappings">
          <dt>e <em>or</em> shift i <em>or</em> y</dt>
          <dd>Mark as read</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>shift m</dt>
          <dd>Mute thread</dd>
        </dl>
      </div><!-- /.column.first -->
    </div>
  </div>

</div>

    <div id="markdown-help" class="instapaper_ignore readability-extra">
  <h2>Markdown Cheat Sheet</h2>

  <div class="cheatsheet-content">

  <div class="mod">
    <div class="col">
      <h3>Format Text</h3>
      <p>Headers</p>
      <pre>
# This is an &lt;h1&gt; tag
## This is an &lt;h2&gt; tag
###### This is an &lt;h6&gt; tag</pre>
     <p>Text styles</p>
     <pre>
*This text will be italic*
_This will also be italic_
**This text will be bold**
__This will also be bold__

*You **can** combine them*
</pre>
    </div>
    <div class="col">
      <h3>Lists</h3>
      <p>Unordered</p>
      <pre>
* Item 1
* Item 2
  * Item 2a
  * Item 2b</pre>
     <p>Ordered</p>
     <pre>
1. Item 1
2. Item 2
3. Item 3
   * Item 3a
   * Item 3b</pre>
    </div>
    <div class="col">
      <h3>Miscellaneous</h3>
      <p>Images</p>
      <pre>
![GitHub Logo](/images/logo.png)
Format: ![Alt Text](url)
</pre>
     <p>Links</p>
     <pre>
http://github.com - automatic!
[GitHub](http://github.com)</pre>
<p>Blockquotes</p>
     <pre>
As Kanye West said:

> We're living the future so
> the present is our past.
</pre>
    </div>
  </div>
  <div class="rule"></div>

  <h3>Code Examples in Markdown</h3>
  <div class="col">
      <p>Syntax highlighting with <a href="http://github.github.com/github-flavored-markdown/" title="GitHub Flavored Markdown" target="_blank">GFM</a></p>
      <pre>
```javascript
function fancyAlert(arg) {
  if(arg) {
    $.facebox({div:'#foo'})
  }
}
```</pre>
    </div>
    <div class="col">
      <p>Or, indent your code 4 spaces</p>
      <pre>
Here is a Python code example
without syntax highlighting:

    def foo:
      if not bar:
        return true</pre>
    </div>
    <div class="col">
      <p>Inline code for comments</p>
      <pre>
I think you should use an
`&lt;addr&gt;` element here instead.</pre>
    </div>
  </div>

  </div>
</div>


    <div id="ajax-error-message">
      <span class="mini-icon mini-icon-exclamation"></span>
      Something went wrong with that request. Please try again.
      <a href="#" class="ajax-error-dismiss">Dismiss</a>
    </div>

    <div id="logo-popup">
      <h2>Looking for the GitHub logo?</h2>
      <ul>
        <li>
          <h4>GitHub Logo</h4>
          <a href="http://github-media-downloads.s3.amazonaws.com/GitHub_Logos.zip"><img alt="Github_logo" src="https://a248.e.akamai.net/assets.github.com/images/modules/about_page/github_logo.png?1338956357" /></a>
          <a href="http://github-media-downloads.s3.amazonaws.com/GitHub_Logos.zip" class="minibutton btn-download download">Download</a>
        </li>
        <li>
          <h4>The Octocat</h4>
          <a href="http://github-media-downloads.s3.amazonaws.com/Octocats.zip"><img alt="Octocat" src="https://a248.e.akamai.net/assets.github.com/images/modules/about_page/octocat.png?1338956357" /></a>
          <a href="http://github-media-downloads.s3.amazonaws.com/Octocats.zip" class="minibutton btn-download download">Download</a>
        </li>
      </ul>
    </div>

    
    
    <span id='server_response_time' data-time='0.45375' data-host='fe1'></span>
  </body>
</html>

